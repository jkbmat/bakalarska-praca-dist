!function t(e,i,n){function o(r,a){if(!i[r]){if(!e[r]){var p="function"==typeof require&&require;if(!a&&p)return p(r,!0);if(s)return s(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[r]={exports:{}};e[r][0].call(h.exports,function(t){var i=e[r][1][t];return o(i?i:t)},h,h.exports,t,e,i,n)}return i[r].exports}for(var s="function"==typeof require&&require,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(t,e,i){var n={storageName:"saved",get:function(t,e){return e=void 0==e?this.storageName:e,this.getObj(e)[t]},set:function(t,e,i){if(i=void 0==i?this.storageName:i,void 0==e)for(var n in t)set(n,t[n]);var o=this.getObj(i);o[t]=e,window.localStorage.setItem(i,JSON.stringify(o))},remove:function(t,e){e=void 0==e?this.storageName:e;var i=this.getObj(e);delete i[t],window.localStorage.setItem(e,JSON.stringify(i))},getObj:function(t){t=void 0==t?this.storageName:t;var e=JSON.parse(window.localStorage.getItem(t));return null===e&&(e={},window.localStorage.setItem(t,JSON.stringify(e))),e}};e.exports=n},{}],2:[function(t,e,i){var n=t("./tools.js"),o=t("./bodyType.js"),s=t("./cameraStyle.js"),r=t("./UIBuilder.js"),a=t("./constants.js"),p=t("./translations.js"),l=t("./updateEvent.js"),h=t("./saver.js"),u=t("./typing.js").Type,c={initialize:function(){for(var t=[],e=0;e<p.strings.length;e++)t.push({text:p.getTranslated("LANGUAGE_NAME",e),value:e});var i=[{type:"button",id:"play",tooltip:"START_TOOLTIP",classList:["important"],text:p.getTranslatedWrapped("START"),onclick:function(){_engine.togglePause();var t=$("#"+this.id);_engine.world.paused?(t.attr("tooltip","START_TOOLTIP"),t.html(p.getTranslatedWrapped("START")),$("#collisions, #tool").each(function(){this.enable()})):(t.attr("tooltip","STOP_TOOLTIP"),t.html(p.getTranslatedWrapped("STOP")),$("#collisions, #tool, #undo, #redo, #clearWorld").each(function(){this.disable()}))}},{type:"break"},{type:"button",id:"save",tooltip:"SAVE_TOOLTIP",text:p.getTranslatedWrapped("SAVE"),onclick:function(){r.popup(c.createSave())}},{type:"button",id:"load",tooltip:"LOAD_TOOLTIP",text:p.getTranslatedWrapped("LOAD"),onclick:function(){r.popup(c.createLoad())}},{type:"break"},{type:"button",id:"clearWorld",tooltip:"CLEAR_WORLD_TOOLTIP",text:el.img({src:"./img/trash.svg"}),onclick:function(){_engine.stateManager.clearWorld()},onupdate:function(t,e){"undefined"==typeof _engine||0!==_engine.entities().length&&_engine.world.paused?$("#"+this.id)[0].enable():$("#"+this.id)[0].disable()}},{type:"break"},{type:"button",id:"undo",tooltip:"UNDO",disabled:!0,text:el.img({src:"./img/undo.svg"}),onclick:function(){_engine.stateManager.undo(),c.buildSidebarWorld(!0)},onupdate:function(t,e){var i=$("#"+this.id)[0];t===l.STATE_CHANGE&&(i.enable(),e.first&&i.disable())}},{type:"button",id:"redo",tooltip:"REDO",disabled:!0,text:el.img({src:"./img/redo.svg"}),onclick:function(){_engine.stateManager.redo(),c.buildSidebarWorld(!0)},onupdate:function(t,e){var i=$("#"+this.id)[0];t===l.STATE_CHANGE&&(i.enable(),e.last&&i.disable())}},{type:"break"},{type:"button",id:"collisions",tooltip:"COLLISION_GROUPS_TOOLTIP",text:p.getTranslatedWrapped("COLLISION_GROUPS"),onclick:function(){r.popup(c.createCollisions())}},{type:"break"},{type:"html",content:p.getTranslatedWrapped("TOOL")},{type:"radio",id:"tool",elements:[{text:el.img({src:"./img/selection.svg"}),tooltip:"SELECTION_TOOL",id:"selectionTool",checked:!0,onclick:function(){_engine.selectTool(n.Selection)}},{text:el.img({src:"./img/rectangle.svg"}),tooltip:"RECTANGLE_TOOL",onclick:function(){_engine.selectTool(n.Rectangle)}},{text:el.img({src:"./img/circle.svg"}),tooltip:"CIRCLE_TOOL",onclick:function(){_engine.selectTool(n.Circle)}}]},{type:"break"},{type:"html",content:p.getTranslatedWrapped("ZOOM")},{type:"range",min:1,max:11,step:.1,value:6,width:"150px",disableWrite:!0,oninput:function(t){_engine.viewport.zoom(t)}},{type:"break"},{type:"select",tooltip:"LANGUAGE_TOOLTIP",options:t,onchange:function(t){p.setLanguage(1*t)}}];r.buildLayout(),$(".ui.toolbar")[0].appendChild(r.build(i)),$(".ui.content")[0].appendChild(el("canvas#mainCanvas"))},createCollisions:function(){for(var t=el("table.collisionTable"),e=0;e<a.COLLISION_GROUPS_NUMBER;e++){for(var i=el("tr"),n=0;n<a.COLLISION_GROUPS_NUMBER;n++){var o=el("td");if(0===e&&n>0)o.innerHTML="<div><span>"+_engine.collisionGroups[n-1].name+"</span></div>";else if(0===n&&0!==e)o.innerHTML=_engine.collisionGroups[e-1].name;else if(e<=n&&0!==n&&0!==e){o.row=e,o.col=n,o.onmouseover=function(t,e,i){return function(){for(var n=i.getElementsByTagName("td"),o=0;o<n.length;o++)n[o].className="",(n[o].row===t&&n[o].col<=e||n[o].col===e&&n[o].row<=t)&&(n[o].className="highlight")}}(e,n,t),o.onmouseout=function(t){return function(){for(var e=t.getElementsByTagName("td"),i=0;i<e.length;i++)e[i].className=""}}(t);var s=el("input",{type:"checkbox"});_engine.getCollision(e-1,n-1)&&s.setAttribute("checked","checked"),s.onchange=function(t,e,i){return function(){_engine.setCollision(t-1,e-1,i.checked?1:0)}}(e,n,s),o.onclick=function(t){return function(e){return e.target===t||(t.checked=!t.checked,void t.onchange())}}(s),o.appendChild(s)}else o.row=e,o.col=n;i.appendChild(o)}t.appendChild(i)}return t},createBehavior:function(e){for(var i=new(t("./behaviorBuilder.js"))(_engine.tokenManager),n=function(t){var e=el("div.behavior"),n=el("div.tokenBuilder",{},[""]),s=el("div"),a=r.button({text:p.getTranslatedWrapped("BEHAVIORS.REMOVE_BEHAVIOR"),classList:["removeButton"],onclick:function(t){return function(){$(t).remove()}}(e)});if(null===t)i.initialize(u.BOOLEAN,n),s.appendChild(o(null,p.getTranslatedWrapped("BEHAVIORS.ACTION"),!1));else{i.buildToken(t.logic,n.firstChild),s.appendChild(o(t.results[0],p.getTranslatedWrapped("BEHAVIORS.ACTION"),!1));for(var l=1;l<t.results.length;l++)s.appendChild(o(t.results[l],p.getTranslatedWrapped("BEHAVIORS.ANOTHER_ACTION"),!0))}return s.appendChild(r.button({text:p.getTranslatedWrapped("BEHAVIORS.NEW_ACTION"),onclick:function(t){var e=document.getElementById(this.id);e.parentNode.insertBefore(o(null,p.getTranslatedWrapped("BEHAVIORS.ANOTHER_ACTION"),!0),e)}})),e.appendChild(el("span.behaviorTitle",{},[el("h2",{},[p.getTranslatedWrapped("BEHAVIORS.CONDITION")]),a])),e.appendChild(n),e.appendChild(s),e.appendChild(el("hr")),e},o=function(t,e,n){var o=el("div"),s=el("div.tokenBuilder",{},[""]),a=r.button({text:p.getTranslatedWrapped("BEHAVIORS.REMOVE_ACTION"),onclick:function(t){return function(){$(t).prev().remove(),$(t).remove()}}(s)});return a.style.float="right",n||(a=""),o.appendChild(el("h2",{},[e,a])),o.appendChild(s),null===t?i.initialize(u.ACTION,s):i.buildToken(t,s.firstChild),o},s=el("div.behaviorWrapper"),a=0;a<e.behaviors.length;a++)s.appendChild(n(e.behaviors[a]));var h=this,c=el("div.bottom",{},[r.button({text:p.getTranslatedWrapped("BEHAVIORS.NEW_BEHAVIOR"),onclick:function(){s.appendChild(n(null)),s.scrollTop=s.scrollHeight}}),r.break(),r.button({text:p.getTranslatedWrapped("BEHAVIORS.CANCEL_BUTTON"),onclick:function(){r.closePopup()}}),r.button({text:p.getTranslatedWrapped("BEHAVIORS.DONE_BUTTON"),onclick:function(){h.saveBehavior(e),l.fire(l.BEHAVIOR_CHANGE,{entities:[this]}),r.closePopup()}})]),d=el("div.behaviorOverlay",{},[el("h1",{},[p.getTranslatedWrapped("BEHAVIORS.TITLE")]),s,c]);return d},createSave:function(){return r.build([{type:"html",content:el("h1",{},[p.getTranslatedWrapped("SAVEUI.TITLE")])},{type:"html",content:el("h2",{},[p.getTranslatedWrapped("SAVEUI.SAVE_REMOTE")])},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SAVEUI.SHARE_CODE")},{type:"button",id:"generateButton",text:p.getTranslatedWrapped("SAVEUI.GENERATE"),onclick:function(){$("#popupContent").addClass("loading"),h.saveRemote().then(function(t){$("#popupContent").removeClass("loading");var e=location.href.replace(location.hash,"")+"#"+t;$("#generateButton").replaceWith($("<input type='text' class='success' id='shareCode' value='"+t+"'><p>"+p.getTranslated("SAVEUI.SHARE_LINK")+"<a href='"+e+"'>"+e+"</a>"));var i=$("#shareCode");i.on("click",function(){$(this).select()})})}},{type:"html",content:el("p")},{type:"html",content:el("hr")},{type:"html",content:el("h2",{},[p.getTranslatedWrapped("SAVEUI.SAVE_LOCAL")])},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SAVEUI.NAME")},{type:"inputText",id:"sceneName",value:(new Date).toLocaleString()},{type:"button",id:"localSave",text:p.getTranslatedWrapped("SAVEUI.SAVE_BUTTON"),onclick:function(){var t=$("#sceneName").val();h.saveLocal(t),$("#localSave").remove(),$("#sceneName").replaceWith(el("span.success",{},[t]))}}])},createLoad:function(){var t=h.getLocalSaves(),e=el("div"),i=function(){h.load(this.toString()),c.buildSidebarWorld(!0),r.closePopup()},n=function(){var t=this.toString();confirm(p.getTranslated("LOADUI.CONFIRM_DELETE")+'"'+t+'"?')&&(h.removeLocal(t),$(".one-save").each(function(){$(this).attr("title")===t&&$(this).remove()}),0===$(".one-save").length&&$("#noLocal").show())};for(var o in t)if(t.hasOwnProperty(o)){var s=r.build([{type:"html",content:el("h2",{},[o])},{type:"button",text:p.getTranslatedWrapped("LOADUI.REMOVE_BUTTON"),onclick:n.bind(o)},{type:"button",text:p.getTranslatedWrapped("LOADUI.LOAD_BUTTON"),onclick:i.bind(t[o])}]);s.classList.add("content"),e.appendChild(el("div.one-save",{title:o},[el.img({src:h.getLocalSaveScreenshot(o)}),s]))}return r.build([{type:"html",content:el("h1",{},[p.getTranslatedWrapped("LOADUI.TITLE")])},{type:"html",content:el("h2",{},[p.getTranslatedWrapped("LOADUI.LOAD_REMOTE")])},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("LOADUI.SHARE_CODE")},{type:"inputText",id:"shareCodeLoad",oninput:function(){$("#shareCodeLoad").removeClass("invalid"),$("#codeError").replaceWith(el("span#codeError"))}},{type:"button",id:"remoteLoad",text:p.getTranslatedWrapped("LOADUI.LOAD_BUTTON"),onclick:function(){$("#popupContent").addClass("loading"),h.loadRemote($("#shareCodeLoad").val()).then(function(t){$("#popupContent").removeClass("loading"),t?(r.closePopup(),c.buildSidebarWorld(!0)):($("#shareCodeLoad").addClass("invalid"),$("#codeError").replaceWith(el("span.failure#codeError",{},[p.getTranslatedWrapped("LOADUI.INVALID_CODE")])))})}},{type:"html",content:el("p")},{type:"html",content:el("span#codeError")},{type:"html",content:el("hr")},{type:"html",content:el("h2",{},[p.getTranslatedWrapped("LOADUI.LOAD_LOCAL")])},{type:"html",content:el("span#noLocal",{style:"display: "+(0===Object.getOwnPropertyNames(t).length?"inline;":"none;")},[p.getTranslatedWrapped("LOADUI.NO_LOCAL")])},{type:"html",content:e}])},saveBehavior:function(e){var i=t("./behavior.js");e.behaviors=[];for(var n=$(".behaviorWrapper .behavior"),o=0;o<n.length;o++){var s=$(".tokenBuilder",n[o]);try{for(var r=_engine.tokenManager.parser.parse(s[0].textContent),a=[],p=1;p<s.length;p++)try{a.push(_engine.tokenManager.parser.parse(s[p].textContent))}catch(t){console.log(t)}if(0===a.length)throw"All results blank";e.behaviors.push(new i(r,a))}catch(t){console.log(t)}}},buildSidebarWorld:function(t){var e=$(".sidebarTop");if(t||"world"!==e[0].showing){e[0].showing="world",e.html("");var i=[{type:"html",content:p.getTranslatedWrapped("SIDEBAR.GRAVITY_X")},{type:"inputNumber",value:_engine.getGravityX(),id:"gravity_x",onchange:function(t){_engine.setGravityX(1*t)},onupdate:function(t,e){t===l.GRAVITY_CHANGE&&$("#"+this.id).val(_engine.getGravityX())}},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SIDEBAR.GRAVITY_Y")},{type:"inputNumber",value:_engine.getGravityY(),id:"gravity_y",onchange:function(t){_engine.setGravityY(1*t)},onupdate:function(t,e){t===l.GRAVITY_CHANGE&&$("#"+this.id).val(_engine.getGravityY())}},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SIDEBAR.CAMERA_STYLE")},{type:"select",selected:_engine.viewport.getCameraStyle(),onchange:function(t){_engine.viewport.setCameraStyle(t),t===s.FIXED&&($(".fixedCamera").show(),$(".entityCamera").hide()),t===s.ENTITY&&($(".fixedCamera").hide(),$(".entityCamera").show())},options:[{text:p.getTranslatedWrapped("SIDEBAR.CAMERA_STYLES.FIXED"),value:s.FIXED},{text:p.getTranslatedWrapped("SIDEBAR.CAMERA_STYLES.ENTITY"),value:s.ENTITY}]},{type:"html",content:el("p")},{type:"html",content:el("span.fixedCamera",{},[p.getTranslatedWrapped("SIDEBAR.CAMERA_X")])},{type:"inputNumber",value:_engine.viewport.x,id:"camera_x",classList:["fixedCamera"],onchange:function(t){_engine.viewport.x=1*t},onupdate:function(t,e){t===l.CAMERA_MOVE&&$("#"+this.id).val(_engine.viewport.x)}},{type:"html",content:el("p")},{type:"html",content:el("span.fixedCamera",{},[p.getTranslatedWrapped("SIDEBAR.CAMERA_Y")])},{type:"inputNumber",value:_engine.viewport.y,id:"camera_y",classList:["fixedCamera"],onchange:function(t){_engine.viewport.y=1*t},onupdate:function(t,e){t===l.CAMERA_MOVE&&$("#"+this.id).val(_engine.viewport.y)}},{type:"html",content:el("p")},{type:"html",content:el("span.entityCamera",{},[p.getTranslatedWrapped("SIDEBAR.CAMERA_ENTITY")])},{type:"inputEntity",value:_engine.viewport.getCameraEntityId(),id:"camera_entity",classList:["entityCamera"],onchange:function(t){_engine.viewport.setCameraEntityId(t)}}];e.html(r.build(i)),_engine.viewport.getCameraStyle()===s.FIXED&&($(".fixedCamera").show(),$(".entityCamera").hide()),_engine.viewport.getCameraStyle()===s.ENTITY&&($(".fixedCamera").hide(),$(".entityCamera").show())}},buildSidebarTop:function(t){switch(t.type){case"entity":this.buildSidebarEntity(t.ptr);break;case"joint":this.buildSidebarJoint(t.ptr);break;default:this.buildSidebarWorld(!0)}},buildSidebarJoint:function(t){void 0==t.jointObject,[{type:"html",content:p.getTranslatedWrapped("SIDEBAR.ID")},{type:"inputText",value:t.id,onchange:function(e){t.setId(e)}},{type:"html",content:el("p")}]},buildSidebarEntity:function(t){var e=$(".sidebar.ui .sidebarTop");e.html(""),e[0].showing="entity";var i=[{type:"html",content:p.getTranslatedWrapped("SIDEBAR.ID")},{type:"inputText",value:t.id,onchange:function(e){t.setId(e)}},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SIDEBAR.COLLISION_GROUP")},{type:"range",value:t.collisionGroup+1,min:1,max:a.COLLISION_GROUPS_NUMBER-1,onchange:function(e){t.setCollisionGroup(1*e-1)}},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SIDEBAR.LAYER")},{type:"range",value:t.layer+1,min:1,max:a.LAYERS_NUMBER,onchange:function(e){_engine.setEntityLayer(t,1*e-1)}},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SIDEBAR.X")},{type:"inputNumber",value:t.getX(),id:"entity_x",onchange:function(e){t.setX(1*e)},onupdate:function(e,i){e===l.REPOSITION&&$("#"+this.id).val(t.getX())}},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SIDEBAR.Y")},{type:"inputNumber",value:t.getY(),id:"entity_y",onchange:function(e){t.setY(1*e)},onupdate:function(e,i){e===l.REPOSITION&&$("#"+this.id).val(t.getY())}},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SIDEBAR.WIDTH")},{type:"inputNumber",value:t.getWidth(),step:.1,id:"entity_width",onchange:function(e){t.resize(e/2,t.getHeight()/2)},onupdate:function(e,i){e===l.RESIZE&&$("#"+this.id).val(t.getWidth())}},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SIDEBAR.HEIGHT")},{type:"inputNumber",value:t.getHeight(),step:.1,id:"entity_height",onchange:function(e){return"CIRCLE"===t.type?void t.resize(e/2):void t.resize(t.getWidth()/2,e/2)},onupdate:function(e,i){e===l.RESIZE&&$("#"+this.id).val(t.getHeight())}},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SIDEBAR.ROTATION")},{type:"range",min:0,max:360,step:1,value:t.getAngle(!0),id:"entity_rotation",onchange:function(e){t.setAngle(1*e,!0)},onupdate:function(e,i){e===l.ROTATE&&($("#"+this.id).val(t.getAngle(!0)),$("#"+this.id+"-input").val(t.getAngle(!0)))}},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SIDEBAR.FIXED_ROTATION")},{type:"checkbox",checked:t.fixedRotation,onchange:function(e){t.disableRotation(e)}},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SIDEBAR.RESTITUTION")},{type:"range",min:0,max:1,step:.1,value:t.getRestitution(),onchange:function(e){t.setRestitution(1*e)}},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SIDEBAR.FRICTION")},{type:"range",min:0,max:1,step:.1,value:t.getFriction(),onchange:function(e){t.setFriction(1*e)}},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SIDEBAR.DENSITY")},{type:"inputNumber",value:t.getDensity(),min:0,onchange:function(e){t.setDensity(1*e)}},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SIDEBAR.COLOR")},{type:"inputColor",value:t.getColor(),oninput:function(e){t.setColor(e)}},{type:"html",content:el("p")},{type:"html",content:p.getTranslatedWrapped("SIDEBAR.BODY_TYPE")},{type:"select",selected:t.getBodyType(),onchange:function(e){t.setBodyType(1*e)},options:[{text:p.getTranslatedWrapped("SIDEBAR.BODY_TYPES.DYNAMIC"),value:o.DYNAMIC_BODY},{text:p.getTranslatedWrapped("SIDEBAR.BODY_TYPES.KINEMATIC"),value:o.KINEMATIC_BODY},{text:p.getTranslatedWrapped("SIDEBAR.BODY_TYPES.STATIC"),value:o.STATIC_BODY}]},{type:"html",content:el("p")},{type:"button",text:p.getTranslatedWrapped("SIDEBAR.DELETE_BUTTON"),onclick:function(){confirm(p.getTranslated("SIDEBAR.DELETE_CONFIRM"))&&_engine.removeEntity(t)}},{type:"html",content:el("p")},{type:"button",text:p.getTranslatedWrapped("SIDEBAR.SET_BEHAVIORS"),onclick:function(){r.popup(c.createBehavior(t))}},{type:"html",content:el("p")}];e[0].appendChild(r.build(i))},toggleSidebar:function(){$(".sidebar.ui").toggleClass("inactive"),$(".ui.content").css("width",$("body").outerWidth()-parseInt($(".sidebar.ui")[0].style.width)),window.onresize()},buildEntityList:function(){for(var t=el("div.entityList"),e=0;e<a.LAYERS_NUMBER;e++)if(0!==_engine.layers[e].length){for(var i=el("div.layer",{},[p.getTranslatedWrapped("LAYER")," "+(e+1)+":"]),n=0;n<_engine.layers[e].length;n++){var o=_engine.layers[e][n],s=el("div.entity",{},[el("span",{},[el("span.id",{},[o.id]),": ",p.getTranslatedWrapped(o.type)]),el("div.entity-color",{style:"background:"+o.getColor()})]);o===_engine.selected.ptr&&s.classList.add("selected"),s.onclick=function(t){return function(){_engine.selectEntity(t)}}(o),i.appendChild(s)}t.appendChild(i)}$(".sidebarBottom").html(t)}};$(document).on("update",function(t){var e=t.detail.action;e!==l.STATE_CHANGE&&e!==l.COLOR_CHANGE&&e!==l.ENTITY_ADD&&e!==l.ENTITY_DELETE&&e!==l.ID_CHANGE&&e!==l.SELECTION_CHANGE&&e!==l.LAYER_CHANGE||c.buildEntityList()}),e.exports=c},{"./UIBuilder.js":3,"./behavior.js":5,"./behaviorBuilder.js":6,"./bodyType.js":7,"./cameraStyle.js":8,"./constants.js":10,"./saver.js":21,"./tools.js":26,"./translations.js":27,"./typing.js":28,"./updateEvent.js":29}],3:[function(t,e,i){var n=t("./translations.js"),o=t("./utils.js"),s=t("./updateEvent.js"),r=t("./tools.js"),a={element:function(t,e){if(e=$.extend({disabled:!1,onclick:function(){},onupdate:function(){},tooltip:"",classList:[]},e),t.disable=function(){this.disabled=!0,$(this).addClass("disabled")},t.enable=function(){this.disabled=!1,$(this).removeClass("disabled")},t.onclick=function(t){return $(this).hasClass("disabled")?void t.preventDefault():void e.onclick()},e.classList.length&&t.classList.add(e.classList),e.disabled&&t.disable(),document.addEventListener("update",function(t){e.onupdate(t.detail.action,t.detail)}),""!==e.tooltip){var i=[15,20];t.setAttribute("tooltip",e.tooltip),t.addEventListener("mouseenter",function(e){if($("#tooltip").remove(),!t.disabled){var o=el.div({id:"tooltip"},[n.getTranslatedWrapped(t.getAttribute("tooltip"))]);document.body.appendChild(o),o.style.left=e.pageX+i[0],o.style.top=e.pageY+i[1]}}),t.addEventListener("mouseleave",function(t){$("#tooltip").remove()}),t.addEventListener("mousemove",function(e){if(!t.disabled){var n=$("#tooltip")[0];n.style.left=e.pageX+i[0],n.style.top=e.pageY+i[1]}})}return t},radio:function(t){t=$.extend({},{id:"radioGroup-"+o.generateUUID()},t);var e=el("div.ui.radioGroup",{id:t.id});return e.disable=function(){$("label",this).each(function(){this.disable()})},e.enable=function(){$("label",this).each(function(){this.enable()})},t.elements.forEach(function(i){i=$.extend({},{id:"radio-"+o.generateUUID(),checked:!1,onclick:function(){}},i);var n=el("input.ui",{type:"radio",id:i.id,name:t.id}),s=el("label.ui.button",{for:i.id},[i.text]);s=this.element(s,i),n.checked=i.checked,e.appendChild(n),e.appendChild(s)}.bind(this)),e},button:function(t){t=$.extend({},{id:"button-"+o.generateUUID(),onclick:function(){},onupdate:function(){},disabled:!1},t);var e=el("span.ui.button",{id:t.id},[t.text]);return this.element(e,t)},select:function(t){t=$.extend({},{id:"select-"+o.generateUUID(),selected:"",onchange:function(){}},t);var e=el("select.ui",{id:t.id});return e.onchange=function(){t.onchange(this.value)},t.options.forEach(function(i,n){e.appendChild(el("option",{value:i.value},[i.text])),i.value==t.selected&&(e.selectedIndex=n)}),this.element(e,t)},break:function(){return el("span.ui.break")},inputText:function(t){t=$.extend({},{id:"inputText-"+o.generateUUID(),value:"",oninput:function(){},onchange:function(){}},t);var e=el("input.ui",{type:"text",id:t.id,value:t.value});return $(e).on("blur keyup",function(e){"keyup"===e.type&&13!=e.keyCode||t.onchange(this.value)}),e.oninput=function(){t.oninput(this.value)},this.element(e,t)},inputNumber:function(t){t=$.extend({},{id:"inputNumber-"+o.generateUUID(),value:0,min:-(1/0),max:1/0,step:1,oninput:function(){},onchange:function(){},onupdate:function(){}},t);var e=el("input.ui",{type:"number",id:t.id,value:t.value,min:t.min,max:t.max,step:t.step});return $(e).on("blur keyup",function(e){"keyup"===e.type&&13!=e.keyCode||t.onchange(this.value)}),e.oninput=function(){t.oninput(this.value)},this.element(e,t)},inputEntity:function(t){t=$.extend({},{id:"inputEntity-"+o.generateUUID(),value:"",oninput:function(){},onchange:function(){}},t);var e=el("input.ui",{type:"text",id:t.id,value:t.value}),i=a.button({id:t.id+"-button",text:el.img({src:"./img/selectEntity.svg"}),onclick:function(){var e=$(i);e.toggleClass("active"),$("#"+t.id+"-error").html(""),_engine.selectTool(r.Selection),e.hasClass("active")?_engine.selectedTool.mode="entity-pick":_engine.selectedTool.mode=""}});$(e).on("blur keyup",function(i){"keyup"===i.type&&13!=i.keyCode||(_engine.getEntityById(this.value)?($(e).addClass("success"),t.onchange(this.value)):$("#"+this.id+"-error").html(el("span.failure",{},[n.getTranslatedWrapped("NO_ENTITY_WITH_ID")])))}),e.oninput=function(){$(e).removeClass("success"),$("#"+this.id+"-error").html(""),t.oninput(this.value)},t.onupdate=function(n,o){n===s.ENTITY_PICKED&&$(i).hasClass("active")&&($(e).val(o.entityId),$(i).removeClass("active"),$(e).removeClass("success"),void $(e)[0].offsetWidth,$(e).addClass("success"),t.onchange($(e).val()))};var p=el.div({},[el("div.ui.entitySelect",{},[this.element(e,t),i]),el("p"),el("span#"+t.id+"-error")]);return t.classList.length&&p.classList.add(t.classList),p},html:function(t){return t=$.extend({},{content:""},t),t.content},inputColor:function(t){t=$.extend({},{id:"inputColor-"+o.generateUUID(),value:"#000000",oninput:function(){}},t);var e=el("input.ui.button",{type:"color",id:t.id,value:t.value});return e.oninput=function(){t.oninput(this.value)},this.element(e,t)},range:function(t){t=$.extend({},{id:"range-"+o.generateUUID(),value:0,min:0,max:10,step:1,width:"100%",disableWrite:!1,oninput:function(){},onchange:function(){},onupdate:function(){}},t);var e=$.extend({},t);e.id+="-input";var i=this.element(el("div.ui.range",{style:"width:"+t.width}),t),n=el("input.ui",{type:"range",min:t.min,max:t.max,step:t.step,value:t.value,id:t.id}),s=this.inputNumber(e);return s.oninput=function(){t.oninput(s.value)},$(s).on("blur keyup",function(e){"keyup"===e.type&&13!=e.keyCode||(n.value=s.value,t.onchange(this.value))}),n.oninput=function(){s.value=this.value,t.oninput(this.value),t.onchange(this.value)},i.appendChild(n),t.disableWrite||i.appendChild(s),i},checkbox:function(t){t=$.extend({},{id:"checkbox-"+o.generateUUID(),checked:!1,onchange:function(){}},t);var e=this.element(el("span"),t),i=el("input.ui",{type:"checkbox",id:t.id}),n=el("label.ui.button",{for:t.id});return e.appendChild(i),e.appendChild(n),i.checked=t.checked,i.onchange=function(){t.onchange(this.checked)},e},build:function(t){var e=el.div();return t.forEach(function(t){var i;switch(t.type){case"radio":i=this.radio(t);break;case"button":i=this.button(t);break;case"select":i=this.select(t);break;case"inputText":i=this.inputText(t);break;case"inputEntity":i=this.inputEntity(t);break;case"inputNumber":i=this.inputNumber(t);break;case"inputColor":i=this.inputColor(t);break;case"checkbox":i=this.checkbox(t);break;case"range":i=this.range(t);break;case"html":i=this.html(t);break;case"break":i=this.break()}e.appendChild(i)},this),e},buildLayout:function(){var t=el("div.ui.content.panel"),e=el("div.ui.sidebarTop.panel"),i=el("div.ui.sidebarBottom.panel"),n=el("div.ui.resizer-horizontal.resizer"),o=el("div.ui.resizer-vertical.resizer"),s=el("div.ui.sidebar.panel",{},[n,e,o,i]),r=el("div.ui.toolbar"),a=el("div.ui.main.panel",{},[t,s]),p=function(e){e.preventDefault();var i=$("body").outerWidth(),n=Math.max(150,Math.min(.6*i,i-e.clientX));s.style.width=n+"px",t.style.width=i-n+"px",window.onresize()},l=function(t){t.preventDefault();var n=$(s).outerHeight(),r=Math.max(.1*n,Math.min(.9*n,_engine.input.mouse.realY-$(s).offset().top-parseInt($(o).css("border-top-width"))));console.log(_engine.input.mouse.realY,parseInt($(o).css("border-top-width")));var a=n-r-$(o).outerHeight();e.style.height=r+"px",i.style.height=a+"px",o.style.top=$(s).offset().top+r+"px"},h=function(t){s.resizing=!1,o.resizing=!1,$(".resizer.ui").removeClass("resizing"),window.removeEventListener("mousemove",p),window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",h)},u=function(){var e=$("body").outerWidth(),i=Math.max(.4*e,Math.min(e-30,e-$(".sidebar.ui").outerWidth())),n=e-i;s.style.width=n+"px",t.style.width=i+"px"};n.onmousedown=function(t){s.resizing=!0,$(this).addClass("resizing"),window.addEventListener("mousemove",p),window.addEventListener("mouseup",h)},o.onmousedown=function(t){$(this).addClass("resizing"),window.addEventListener("mousemove",l),window.addEventListener("mouseup",h)},window.addEventListener("resize",u),document.body.appendChild(r),document.body.appendChild(a),s.style.width=$(".ui.sidebar").css("width")},popup:function(t){var e=el("div#popupOverlay",[el("div#popupContent.ui",[t])]);e.onclick=function(t){a.closePopup(t)},document.body.insertBefore(e,document.body.firstChild),n.refresh()},closePopup:function(t){var e=document.getElementById("popupOverlay"),i=document.getElementById("popupContent");return"undefined"!=typeof t&&t.target!==e||(i.parentNode.removeChild(i),void e.parentNode.removeChild(e))}};e.exports=a},{"./tools.js":26,"./translations.js":27,"./updateEvent.js":29,"./utils.js":30}],4:[function(t,e,i){var n=t("./token.js").Action,o=t("./typing.js").Type;e.exports=[];var s=function(t,e){n.call(this,"setColor",arguments,[o.ENTITYFILTER,o.STRING]),this.args.push(t),this.args.push(e)};s.prototype=new n,s.prototype.each=function(t){t.setColor(this.args[1].evaluate(),!0)},s.prototype.constructor=s,e.exports.push(s);var r=function(t,e){n.call(this,"applyTorque",arguments,[o.ENTITYFILTER,o.NUMBER]),this.args.push(t),this.args.push(e)};r.prototype=new n,r.prototype.each=function(t){t.body.SetAwake(1),t.body.ApplyTorque(t.getMass()*this.args[1].evaluate())},r.prototype.constructor=r,e.exports.push(r);var a=function(t,e){n.call(this,"applyAngularImpulse",arguments,[o.ENTITYFILTER,o.NUMBER]),this.args.push(t),this.args.push(e)};a.prototype=new n,a.prototype.each=function(t){t.body.SetAwake(1),t.body.ApplyAngularImpulse(t.getMass()*this.args[1].evaluate())},a.prototype.constructor=a,e.exports.push(a);var p=function(t,e,i){n.call(this,"setLinearVelocity",arguments,[o.ENTITYFILTER,o.NUMBER,o.NUMBER]),this.args.push(t),this.args.push(e),this.args.push(i)};p.prototype=new n,p.prototype.each=function(t){t.body.SetAwake(1),t.setLinearVelocity(new b2Vec2(this.args[1].evaluate(),this.args[2].evaluate()))},p.prototype.constructor=p,e.exports.push(p);var l=function(t,e,i){n.call(this,"applyLinearImpulse",arguments,[o.ENTITYFILTER,o.NUMBER,o.NUMBER]),this.args.push(t),this.args.push(e),this.args.push(i)};l.prototype=new n,l.prototype.each=function(t){t.body.SetAwake(1),t.applyLinearImpulse(new b2Vec2(t.getMass()*this.args[1].evaluate(),t.getMass()*this.args[2].evaluate()))},l.prototype.constructor=l,e.exports.push(l)},{"./token.js":24,"./typing.js":28}],5:[function(t,e,i){var n=function(t,e){this.logic=t,this.results=Array.isArray(e)?e:[e]};n.prototype.check=function(t){return this.logic.evaluate(t)},n.prototype.toString=function(){return"Behavior("+this.logic.toString()+", "+this.results.toString()+")"},n.prototype.result=function(){for(var t=0;t<this.results.length;t++)this.results[t].execute()},e.exports=n},{}],6:[function(t,e,i){var n=t("./typing.js").FixType,o=t("./typing.js").Type,s=function(t){this.tokenManager=t};s.prototype.initialize=function(t,e){var i=el("span.ui.button",{},["+"]);i.type=t,i.onclick=this.buildChoiceClick(),$(e).html(i)},s.prototype.buildChoiceClick=function(){var t=this;return function(e){e.stopPropagation(),t.buildChoice(t.tokenManager.getTokensByType(this.type),this)}},s.prototype.buildArgument=function(t,e,i){return void 0!=t.args[e]?t.argument_types[e]===o.LITERAL?($(i).replaceWith(document.createTextNode(t.args[e])),!0):(this.buildToken(t.args[e],i),!0):t.argument_types[e]===o.LITERAL?(t.populate(),!!t.validate()&&($(i).replaceWith(document.createTextNode(t.args[e])),!0)):(this.initialize(t.argument_types[e],i),!0)},s.prototype.buildToken=function(t,e){var i=el("span.token",{},[el("span.name",{},[t.name])]);i.type=t.type,i.onclick=this.buildChoiceClick();var o;if(i.onmouseover=function(t){t.stopPropagation(),$(this).addClass("hover")},i.onmouseout=function(t){$(this).removeClass("hover")},t.fixType===n.PREFIX){i.appendChild(document.createTextNode("( "));for(var s=this,r=0;r<t.argument_types.length;r++){if(o=el("span.argument"),i.appendChild(o),!s.buildArgument(t,r,o))return;r!==t.argument_types.length-1&&i.appendChild(document.createTextNode(", "))}i.appendChild(document.createTextNode(" )"))}t.fixType===n.INFIX&&(i.insertBefore(document.createTextNode(" ) "),i.firstChild),i.appendChild(document.createTextNode(" ( ")),o=el("span"),i.insertBefore(o,i.firstChild),i.insertBefore(document.createTextNode(" ( "),i.firstChild),this.buildArgument(t,0,o),o=el("span"),i.appendChild(o),i.appendChild(document.createTextNode(" ) ")),this.buildArgument(t,1,o)),$(e).replaceWith(i)},s.prototype.buildChoice=function(t,e){$("div#tokenChoice").remove();var i=el("div#tokenChoice"),o=this;t.forEach(function(t){var s=el("div.token",{},[el("span.name",{},[t.name])]);t.fixType===n.PREFIX&&s.appendChild(el("span.argument",{},["( ",t.argument_types.join(", ")," )"])),t.fixType===n.INFIX&&(s.insertBefore(el("span.argument",{},["( ",t.argument_types[0]," )"]),s.firstChild),s.appendChild(el("span.argument",{},["( ",t.argument_types[1]," )"]))),$(s).on("click",function(i){o.buildToken(new t.constructor,e)}),i.appendChild(s)}),document.body.appendChild(i),$(document).one("click",function(t){$("div#tokenChoice").remove()});var s=15;$(i).css("left",_engine.input.mouse.realX+s+"px"),$(i).css("top",_engine.input.mouse.realY+s+"px")},e.exports=s},{"./typing.js":28}],7:[function(t,e,i){var n={DYNAMIC_BODY:Module.b2_dynamicBody,STATIC_BODY:Module.b2_staticBody,KINEMATIC_BODY:Module.b2_kinematicBody};e.exports=n},{}],8:[function(t,e,i){var n={FIXED:"fixed",ENTITY:"entity"};e.exports=n},{}],9:[function(t,e,i){var n=t("./constants.js"),o=function(t,e,i,o,s,r,a,p){
return this.width=e,this.height=i,this.image=new Image,this.image.src=s,this.position=o,this.entity=t,this.collisionGroup=n.COLLISION_GROUPS_NUMBER-1,this.recalculatePosition(),void 0==r&&(r=function(){}),void 0==a&&(a=function(){}),void 0==p&&(p=function(){}),this.move=r.bind(this),this.click=function(){a.apply(this,arguments),$(document).one("mouseup",this.release),$(_engine.viewport.canvasElement).on("mousemove",this.move)},this.release=function(){p.apply(this,arguments),$(_engine.viewport.canvasElement).off("mousemove",this.move)},this};o.prototype.recalculatePosition=function(){var t=this.entity.getWidth(),e=this.entity.getHeight();this.x=t/2*this.position[0],this.y=e/2*this.position[1],this.fixture&&this.entity.body.DestroyFixture(this.fixture),this.shape=new b2PolygonShape,this.shape.SetAsBox(_engine.viewport.toScale(this.width/2),_engine.viewport.toScale(this.height/2),new b2Vec2(this.x,this.y),0),this.fixture=new b2FixtureDef,this.fixture.set_shape(this.shape);var i=this.fixture.get_filter();i.set_categoryBits(1<<this.collisionGroup),i.set_maskBits(_engine.collisionGroups[this.collisionGroup].mask),this.fixture.set_filter(i),this.fixture=this.entity.body.CreateFixture(this.fixture)},o.prototype.testPoint=function(t,e){return this.fixture.TestPoint(new b2Vec2(t,e))},o.prototype.draw=function(t){t.drawImage(this.image,-this.width/2,-this.height/2,this.width,this.height)},e.exports=o},{"./constants.js":10}],10:[function(t,e,i){e.exports={COLLISION_GROUPS_NUMBER:16,LAYERS_NUMBER:10,DEFAULT_SCALE:1/70,AUTO_ID_PREFIX:"Entity ",SHAPE_MIN_SIZE:.2,TIME_STEP:60,STATE_STACK_SIZE:30,POSITION_TOP_LEFT:[-1,-1],POSITION_TOP:[0,-1],POSITION_TOP_RIGHT:[1,-1],POSITION_RIGHT:[1,0],POSITION_BOTTOM_RIGHT:[1,1],POSITION_BOTTOM:[0,1],POSITION_BOTTOM_LEFT:[-1,1],POSITION_LEFT:[-1,0],sideOrder:[[0,-1],[1,0],[0,1],[-1,0]]}},{}],11:[function(t,e,i){var n=t("./UI.js"),o=t("./tools.js"),s=t("./tokenManager.js"),r=t("./constants.js"),a=t("./updateEvent.js"),p=t("./stateManager.js"),l=t("./cameraStyle.js"),h=t("./geometry.js"),u=function(e,i){this.viewport=e,this.selected={type:null,ptr:null},this.selectedTool=o.Selection,this.helpers=[],this.bufferVec2=new b2Vec2(0,0),this.layers=new Array(r.LAYERS_NUMBER);for(var n=0;n<r.LAYERS_NUMBER;n++)this.layers[n]=[];this.joints=[],this.collisionGroups=[];for(var n=0;n<r.COLLISION_GROUPS_NUMBER-1;n++)this.collisionGroups.push({name:n+1,mask:parseInt("0"+Array(r.COLLISION_GROUPS_NUMBER).join("1"),2)});this.collisionGroups.push({name:"Helpers",mask:parseInt(Array(r.COLLISION_GROUPS_NUMBER+1).join("0"),2)}),this.lifetimeEntities=0,this.lifetimeJoints=0,this.world=new b2World(i,(!0)),this.world.paused=!0,this.tokenManager=new s;var a=t("./input.js");this.input=new a(e),this.stateManager=new p(this),$(e.canvasElement).on("mousedown",function(){this.selectedTool.onclick()}.bind(this)),$(e.canvasElement).on("mouseup",function(){this.selectedTool.onrelease()}.bind(this)),$(document).on("update",function(t){t.detail.noState||this.stateManager.addState()}.bind(this))};u.prototype.togglePause=function(){if(this.world.paused=!this.world.paused,this.selectEntity(null),this.selectTool(this.world.paused?o.Selection:o.Blank),$("#selectionTool")[0].checked=!0,this.world.paused)n.toggleSidebar(),this.stateManager.buildState(this.stateManager.stateStack[this.stateManager.currentState]);else{var t=this.entities();t.forEach(function(t){t.body.SetAwake(1)}),n.toggleSidebar()}},u.prototype.getGravityX=function(){return this.world.GetGravity().get_x()},u.prototype.getGravityY=function(){return this.world.GetGravity().get_y()},u.prototype.setGravity=function(t,e,i){this.world.SetGravity(new b2Vec2(t,e)),i||a.fire(a.GRAVITY_CHANGE)},u.prototype.setGravityX=function(t){this.setGravity(t,this.getGravityY())},u.prototype.setGravityY=function(t){this.setGravity(this.getGravityX(),t)},u.prototype.selectTool=function(t){this.selectedTool=t,this.selectEntity(null)},u.prototype.addEntity=function(t,e,i){return void 0===t.id&&(t.id=r.AUTO_ID_PREFIX+this.lifetimeEntities),this.lifetimeEntities++,t.body.set_type(e),t.body=this.world.CreateBody(t.body),t.fixture=t.body.CreateFixture(t.fixture),this.layers[t.layer].push(t),t.addHelpers(),i||a.fire(a.ENTITY_ADD,{entities:[t]}),t},u.prototype.removeEntity=function(t,e){this.selectEntity(null,e),this.world.DestroyBody(t.body),this.layers[t.layer].splice(this.layers[t.layer].indexOf(t),1),e||a.fire(a.ENTITY_DELETE,{entities:[t]})},u.prototype.addJoint=function(t,e){t.id=void 0==t.id?"Joint "+this.lifetimeJoints++:t.id,t.jointObject=this.world.CreateJoint(t.getDefinition()),this.joints.push(t),e||a.fire(a.JOINT_ADD)},u.prototype.removeJoint=function(t){this.world.DestroyJoint(t.jointObject),this.joints.splice(this.joints.indexOf(t),1),silent||a.fire(a.JOINT_REMOVE)},u.prototype.setEntityLayer=function(t,e,i){this.layers[t.layer].splice(this.layers[t.layer].indexOf(t),1),t.layer=e,this.layers[e].push(t),i||a.fire(a.LAYER_CHANGE,{entities:[t]})},u.prototype.entities=function(){return[].concat.apply([],this.layers)},u.prototype.getEntityById=function(t){for(var e=this.entities(),i=0;i<e.length;i++)if(e[i].id===t)return e[i];return null},u.prototype.getEntitiesByCollisionGroup=function(t){for(var e=[],i=this.entities(),n=0;n<i.length;n++)i[n].collisionGroup===t&&e.push(i[n]);return e},u.prototype.getCollision=function(t,e){return this.collisionGroups[t].mask>>e&1},u.prototype.setCollision=function(t,e,i){var n=1<<e,o=1<<t;return i?(this.collisionGroups[t].mask=this.collisionGroups[t].mask|n,this.collisionGroups[e].mask=this.collisionGroups[e].mask|o):(this.collisionGroups[t].mask=this.collisionGroups[t].mask&~n,this.collisionGroups[e].mask=this.collisionGroups[e].mask&~o),this.updateCollisions(),this},u.prototype.selectEntity=function(t,e){this.selected={type:void 0==t?null:"entity",ptr:t},n.buildSidebarTop(this.selected),t&&t.recalculateHelpers(),e||a.fire(a.SELECTION_CHANGE,{noState:!0,entities:[t]})},u.prototype.updateCollisions=function(){for(var t=this.entities(),e=0;e<t.length;e++)this.updateCollision(t[e]);return this},u.prototype.updateCollision=function(t,e){var i=t.fixture.GetFilterData();return i.set_maskBits(this.collisionGroups[t.collisionGroup].mask),t.fixture.SetFilterData(i),e||a.fire(a.COL_GROUP_CHANGE,{entities:[t]}),this},u.prototype.step=function(){var t=Date.now();if(ctx=this.viewport.context,ctx.clearRect(0,0,this.viewport.width,this.viewport.height),ctx.save(),this.world.paused)this.selectedTool.onmove(ctx);else{this.world.Step(1/r.TIME_STEP,10,5);var e=this.entities();if(this.viewport.getCameraStyle()===l.ENTITY){var i=this.getEntityById(this.viewport.getCameraEntityId());this.viewport.x=i.getX(),this.viewport.y=i.getY()}for(var n=0;n<e.length;n++)for(var o=0;o<e[n].behaviors.length;o++){var s=e[n].behaviors[o];s.check(e[n])&&s.result()}}for(var a=0;a<r.LAYERS_NUMBER;a++)for(var i=this.layers[a].length-1;i>=0;i--)this.drawEntity(this.layers[a][i],ctx);for(var p=0;p<this.joints.length;p++)this.drawJoint(this.joints[p],ctx);"entity"===this.selected.type&&(this.drawBoundary(ctx),this.selected.ptr.showHelpers&&this.drawHelpers(this.selected.ptr,ctx)),this.input.cleanUp();var h=Date.now();setTimeout(window.requestAnimationFrame(function(){_engine.step()}),Math.min(r.TIME_STEP-h-t,0))},u.prototype.drawBoundary=function(t){var e=this.selected.ptr.getWidth()/2,i=this.selected.ptr.getHeight()/2,n=this.selected.ptr.getX(),o=this.selected.ptr.getY();t.save(),t.translate(this.viewport.fromScale(-this.viewport.x+n)+this.viewport.width/2,this.viewport.fromScale(-this.viewport.y+o)+this.viewport.height/2),t.rotate(this.selected.ptr.getAngle()),t.globalCompositeOperation="xor",t.strokeRect(this.viewport.fromScale(-e),this.viewport.fromScale(-i),this.viewport.fromScale(2*e),this.viewport.fromScale(2*i)),t.restore()},u.prototype.drawHelpers=function(t,e){e.save(),e.translate(this.viewport.fromScale(-this.viewport.x+t.getX())+this.viewport.width/2,this.viewport.fromScale(-this.viewport.y+t.getY())+this.viewport.height/2),e.rotate(t.getAngle());for(var i=0;i<t.helpers.length;i++){e.save();var n=t.helpers[i].x,o=t.helpers[i].y;e.translate(this.viewport.fromScale(n),this.viewport.fromScale(o)),t.helpers[i].draw(e),e.restore()}e.restore()},u.prototype.drawEntity=function(t,e){e.save(),e.translate(this.viewport.fromScale(-this.viewport.x+t.getX())+this.viewport.width/2,this.viewport.fromScale(-this.viewport.y+t.getY())+this.viewport.height/2),e.rotate(t.getAngle()),t===this.selected.ptr&&(e.globalAlpha=1),e.fillStyle=t.color,t.draw(e),e.restore()},u.prototype.drawJoint=function(t,e){e.save();var i=h.pointRotate(t.entityA.getPosition(),new b2Vec2(t.entityA.getX()+t.localAnchorA[0],t.entityA.getY()+t.localAnchorA[1]),t.entityA.getAngle()),n=h.pointRotate(t.entityB.getPosition(),new b2Vec2(t.entityB.getX()+t.localAnchorB[0],t.entityB.getY()+t.localAnchorB[1]),t.entityB.getAngle());e.translate(this.viewport.fromScale(-this.viewport.x)+this.viewport.width/2,this.viewport.fromScale(-this.viewport.y)+this.viewport.height/2),e.strokeStyle=t.color,e.lineWidth=2,e.beginPath(),e.moveTo(this.viewport.fromScale(i.get_x()),this.viewport.fromScale(i.get_y())),e.lineTo(this.viewport.fromScale(n.get_x()),this.viewport.fromScale(n.get_y())),e.closePath(),e.stroke(),e.fillStyle=t.entityA.getColor(),e.beginPath(),e.arc(this.viewport.fromScale(i.get_x()),this.viewport.fromScale(i.get_y()),4,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke(),e.fillStyle=t.entityB.getColor(),e.beginPath(),e.arc(this.viewport.fromScale(n.get_x()),this.viewport.fromScale(n.get_y()),4,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke(),e.restore()},e.exports=u},{"./UI.js":2,"./cameraStyle.js":8,"./constants.js":10,"./geometry.js":16,"./input.js":17,"./stateManager.js":23,"./tokenManager.js":25,"./tools.js":26,"./updateEvent.js":29}],12:[function(t,e,i){var n=t("./utils.js"),o=t("./constants.js"),s=t("./geometry.js"),r=t("./updateEvent.js"),a=t("./behavior.js"),p=[0,230],l=function(t,e,i,o,s){if(this.id=o,this.dead=!1,this.layer=0,this.helpers=[],this.showHelpers=!0,this.fixedRotation=!1,this.collisionGroup=s,void 0==this.collisionGroup&&(this.collisionGroup=0),this.behaviors=[],this.fixture=e,void 0==this.fixture){var r=new b2FixtureDef;r.set_density(10),r.set_friction(.5),r.set_restitution(.2),this.fixture=r}this.fixture.set_shape(t);var a=this.fixture.get_filter();a.set_categoryBits(1<<s),"undefined"!=typeof _engine&&a.set_maskBits(_engine.collisionGroups[this.collisionGroup].mask),this.fixture.set_filter(a),this.body=i,void 0!==this.body&&this.body.set_fixedRotation(!1);var l=n.randomRange(p[0],p[1]).toString(16);l=1==l.length?"0"+l:l;var h=n.randomRange(p[0],p[1]).toString(16);h=1==h.length?"0"+h:h;var u=n.randomRange(p[0],p[1]).toString(16);u=1==u.length?"0"+u:u,this.color="#"+l+h+u};l.export=function(){return{x:this.getX(),y:this.getY(),width:this.getWidth(),height:this.getHeight(),angle:this.getAngle(),fixedRotation:this.fixedRotation,type:this.type,color:this.getColor(),restitution:this.getRestitution(),friction:this.getFriction(),density:this.getDensity(),bodyType:this.getBodyType(),id:this.id,collisionGroup:this.collisionGroup,behaviors:_.map(this.behaviors,function(t){return[t.logic.toString(),_.map(t.results,function(t){return t.toString()})]})}},l.import=function(t){_engine.addEntity(this,t.bodyType,!0),this.setPosition(t.x,t.y,!0),this.setAngle(t.angle,!1,!0),this.disableRotation(t.fixedRotation,!0),this.setId(t.id,!0),this.setCollisionGroup(t.collisionGroup,!0),this.setColor(t.color,!0),_.each(t.behaviors,function(t){this.addBehavior(new a(_engine.tokenManager.parser.parse(t[0]),_.map(t[1],function(t){return _engine.tokenManager.parser.parse(t)})))}.bind(this)),this.fixture.SetDensity(t.density),this.fixture.SetFriction(t.friction),this.fixture.SetRestitution(t.restitution)},l.prototype.getPosition=function(){return this.body.GetPosition()},l.prototype.setPosition=function(t,e,i){void 0==e&&(e=t.get_y(),t=t.get_x()),this.body.SetTransform(new b2Vec2(t,e),this.getAngle()),i||r.fire(r.REPOSITION,{entities:[this]})},l.prototype.getAngle=function(t){return t?s.clampDegrees(s.toDegrees(this.body.GetAngle())):s.clampRadians(this.body.GetAngle())},l.prototype.setAngle=function(t,e,i){var n=e?s.toRadians(t):t;this.body.SetTransform(this.getPosition(),s.clampRadians(n)),i||r.fire(r.ROTATE,{entities:[this]})},l.prototype.getX=function(){return this.body.GetPosition().get_x()},l.prototype.getY=function(){return this.body.GetPosition().get_y()},l.prototype.setX=function(t){this.setPosition(t,this.getY())},l.prototype.setY=function(t){this.setPosition(this.getX(),t)},l.prototype.getWidth=function(){throw"ERROR! Cannot get width: Use derived class."},l.prototype.getHeight=function(){throw"ERROR! Cannot get height: Use derived class."},l.prototype.getRestitution=function(){return this.fixture.GetRestitution()},l.prototype.setRestitution=function(t){this.fixture.SetRestitution(t),this.body.ResetMassData(),this.resize(this.getWidth()/2,this.getHeight()/2),_engine.world.Step(0,0,0),r.fire(r.RESTITUTION_CHANGE,{entities:[this]})},l.prototype.getFriction=function(){return this.fixture.GetFriction()},l.prototype.setFriction=function(t){this.fixture.SetFriction(t),this.body.ResetMassData(),this.resize(this.getWidth()/2,this.getHeight()/2),_engine.world.Step(0,0,0),r.fire(r.FRICTION_CHANGE,{entities:[this]})},l.prototype.getDensity=function(){return this.fixture.GetDensity()},l.prototype.setDensity=function(t){this.fixture.SetDensity(t),this.body.ResetMassData(),this.resize(this.getWidth()/2,this.getHeight()/2),_engine.world.Step(0,0,0),r.fire(r.DENSITY_CHANGE,{entities:[this]})},l.prototype.getColor=function(){return this.color},l.prototype.setColor=function(t,e){return this.color=t,e||r.fire(r.COLOR_CHANGE,{entities:[this]}),this},l.prototype.getBodyType=function(){return this.body.GetType()},l.prototype.setBodyType=function(t,e){this.body.SetType(t),e||r.fire(r.BODY_TYPE_CHANGE,{entities:[this]})},l.prototype.addHelpers=function(){throw"ERROR! Cannot add helpers: Use derived class."},l.prototype.toggleHelpers=function(t){_engine.selected.ptr.showHelpers=t?t:!_engine.selected.ptr.showHelpers},l.prototype.recalculateHelpers=function(){for(var t=0;t<this.helpers.length;t++)this.helpers[t].recalculatePosition()},l.prototype.startRotate=function(){this.startRotation=this.entity.getAngle(),this.startPosition=new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y),this.entity.toggleHelpers(!1)},l.prototype.moveRotate=function(){this.entity.setAngle(this.startRotation+s.findAngleWithNegative(this.startPosition,new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y),this.entity.getPosition()),!1,!0)},l.prototype.getSide=function(t){var e=this.getX(),i=this.getY(),n=new b2Vec2(e,i),r=this.getWidth(),a=this.getHeight(),p=o.sideOrder.equalIndexOf(t)*(Math.PI/2),l=new b2Vec2(e-r/2,i-a/2),h=new b2Vec2(e+r/2,i-a/2),u=s.pointRotate(n,l,p),c=s.pointRotate(n,h,p);return[u,c]},l.prototype.die=function(){return this.dead=!0,this},l.prototype.draw=function(){throw"ERROR! Cannot draw Entity: Use derived classes."},l.prototype.setId=function(t,e){return this.id=t,e||r.fire(r.ID_CHANGE,{entities:[this]}),this},l.prototype.setCollisionGroup=function(t,e){return this.collisionGroup=t,_engine.updateCollision(this,e),this},l.prototype.getLinearVelocity=function(){return this.body.GetLinearVelocity()},l.prototype.getMass=function(){return Math.max(1,this.body.GetMass())},l.prototype.setLinearVelocity=function(t){return this.body.SetLinearVelocity(t),this},l.prototype.applyTorque=function(t){return this.body.ApplyTorque(t),this},l.prototype.applyLinearImpulse=function(t){return this.body.ApplyLinearImpulse(t,this.body.GetWorldCenter()),this},l.prototype.disableRotation=function(t,e){return this.fixedRotation=t,this.body.SetFixedRotation(t),e||r.fire(r.ROTATION_LOCKED,{entities:[this]}),this},l.prototype.addBehavior=function(t){return this.behaviors.push(t),this},e.exports=l},{"./behavior.js":5,"./constants.js":10,"./geometry.js":16,"./updateEvent.js":29,"./utils.js":30}],13:[function(t,e,i){var n=t("./token.js").EntityFilter,o=t("./typing.js").Type;e.exports=[];var s=function(t){n.call(this,"filterById",arguments,[o.STRING]),this.args.push(t)};s.prototype=new n,s.prototype.decide=function(t){return t.id===this.args[0].evaluate()},s.prototype.constructor=s,e.exports.push(s);var r=function(t){n.call(this,"filterByGroup",arguments,[o.NUMBER]),this.args.push(t)};r.prototype=new n,r.prototype.decide=function(t){return t.collisionGroup+1===this.args[0].evaluate()},r.prototype.constructor=r,e.exports.push(r);var a=function(t){n.call(this,"filterByLayer",arguments,[o.NUMBER]),this.args.push(t)};a.prototype=new n,a.prototype.decide=function(t){return t.layer+1===this.args[0].evaluate()},a.prototype.constructor=a,e.exports.push(a)},{"./token.js":24,"./typing.js":28}],14:[function(t,e,i){t("./input.js");var n=t("./engine.js"),o=t("./viewport.js"),s=t("./UI.js"),r=t("./translations.js"),a=t("./saver.js");t("./bodyType.js"),t("./behavior.js"),t("./firebase.js"),t("./shapes.js").Circle,t("./shapes.js").Rectangle;s.initialize(),window._engine=new n(new o($("#mainCanvas")[0]),new b2Vec2(0,10)),""!==window.location.hash?($(document.body).addClass("loading"),a.loadRemote(window.location.hash.substr(1)).then(function(t){$(document.body).removeClass("loading"),t||(alert(r.getTranslated("LOADUI.INVALID_CODE")),a.loadCurrent())})):a.loadCurrent(),s.buildSidebarWorld(),window.requestAnimationFrame(function(){_engine.step()})},{"./UI.js":2,"./behavior.js":5,"./bodyType.js":7,"./engine.js":11,"./firebase.js":15,"./input.js":17,"./saver.js":21,"./shapes.js":22,"./translations.js":27,"./viewport.js":31}],15:[function(t,e,i){var n={apiKey:"AIzaSyDan0DFvZ9f12FbwWAji2nccZDWfWlFC_Q",authDomain:"bakalarska-praca-8c17f.firebaseapp.com",databaseURL:"https://bakalarska-praca-8c17f.firebaseio.com",storageBucket:"bakalarska-praca-8c17f.appspot.com",messagingSenderId:"18153410974"};firebase.initializeApp(n),firebase.auth().signInAnonymously(),firebase.auth().onAuthStateChanged(function(t){t&&(window.user=t)}),e.exports=firebase.database()},{}],16:[function(t,e,i){e.exports={pointPointDistance:function(t,e){return Math.sqrt(this.pointPointDistance2(t,e))},pointPointDistance2:function(t,e){var i=t.get_x(),n=e.get_x(),o=t.get_y(),s=e.get_y();return this.square(i-n)+this.square(o-s)},square:function(t){return t*t},linePointDistance:function(t,e,i){var n=this.pointPointDistance2(t,e),o=t.get_x(),s=e.get_x(),r=i.get_x(),a=t.get_y(),p=e.get_y(),l=i.get_y();if(0===n)return this.pointPointDistance2(i,t);var h=((r-o)*(s-o)+(l-a)*(p-a))/n;return h=Math.max(0,Math.min(1,h)),this.pointPointDistance(i,new b2Vec2(o+h*(s-o),a+h*(p-a)))},pointRotate:function(t,e,i){i=-i;var n=Math.cos(i),o=Math.sin(i),s=t.get_x(),r=t.get_y(),a=e.get_x(),p=e.get_y();return new b2Vec2(n*(a-s)+o*(p-r)+s,n*(p-r)-o*(a-s)+r)},findAngle:function(t,e,i){var n=t.get_x(),o=e.get_x(),s=i.get_x(),r=t.get_y(),a=e.get_y(),p=i.get_y(),l=Math.sqrt(Math.pow(s-n,2)+Math.pow(p-r,2)),h=Math.sqrt(Math.pow(s-o,2)+Math.pow(p-a,2)),u=Math.sqrt(Math.pow(o-n,2)+Math.pow(a-r,2));return Math.acos((h*h+l*l-u*u)/(2*h*l))},findAngleWithNegative:function(t,e,i){var n=i.get_x(),o=i.get_y(),s=t.get_x(),r=t.get_y(),a=e.get_x(),p=e.get_y(),l=s-n,h=r-o,u=a-n,c=p-o;return Math.atan2(l,h)-Math.atan2(u,c)},toDegrees:function(t){return t*(180/Math.PI)},toRadians:function(t){return t*(Math.PI/180)},clampDegrees:function(t){return(t%360+360)%360},clampRadians:function(t){return(t%(2*Math.PI)+2*Math.PI)%(2*Math.PI)}}},{}],17:[function(t,e,i){var n=function(t){"use strict";this.viewport=t,this.mouse={x:0,y:0,canvasX:0,canvasY:0,realX:0,realY:0,leftDown:!1,rightDown:!1,leftUp:!1,rightUp:!1},this.keyboard={down:new Set,up:new Set,isDown:function(t){return this.down.has(t)},isUp:function(t){return this.up.has(t)}},document.addEventListener("mousemove",this.updateMousePosition.bind(this)),document.addEventListener("mousedown",this.updateMouseButtonsDown.bind(this)),document.addEventListener("mouseup",this.updateMouseButtonsUp.bind(this)),document.addEventListener("keydown",this.updateKeyboardButtonsDown.bind(this)),document.addEventListener("keyup",this.updateKeyboardButtonsUp.bind(this)),this.viewport.onselectstart=function(){return!1},$(".ui.toolbar").on("selectstart",function(){return!1})};n.prototype.cleanUp=function(){this.mouse.leftUp=!1,this.mouse.rightUp=!1,this.keyboard.up.clear()},n.prototype.updateMousePosition=function(t){this.mouse.canvasX=t.pageX-this.viewport.canvasElement.getBoundingClientRect().left,this.mouse.canvasY=t.pageY-this.viewport.canvasElement.getBoundingClientRect().top,this.mouse.x=this.viewport.toScale(this.mouse.canvasX)+this.viewport.x-this.viewport.toScale(this.viewport.width)/2,this.mouse.y=this.viewport.toScale(this.mouse.canvasY)+this.viewport.y-this.viewport.toScale(this.viewport.height)/2,this.mouse.realX=t.pageX,this.mouse.realY=t.pageY},n.prototype.updateMouseButtonsDown=function(t){1===t.which&&(this.mouse.leftDown=!0),3===t.which&&(this.mouse.rightDown=!0)},n.prototype.updateMouseButtonsUp=function(t){1===t.which&&(this.mouse.leftDown=!1,this.mouse.leftUp=!0),3===t.which&&(this.mouse.rightDown=!1,this.mouse.rightUp=!0)},n.prototype.updateKeyboardButtonsDown=function(t){this.keyboard.down.add(t.which)},n.prototype.updateKeyboardButtonsUp=function(t){this.keyboard.down.delete(t.which),this.keyboard.up.add(t.which)},e.exports=n},{}],18:[function(t,e,i){e.exports.REVOLUTE="revolute",e.exports.ROPE="rope";var n=function(t,e,i,n,o,s,r){this.id=r,this.type=t,this.entityA=e,this.entityB=i,this.localAnchorA=n,this.localAnchorB=o,this.collide=s,this.jointObject=null,this.color="black"};n.getDefinition=function(t){t.set_bodyA(this.entityA.body),t.set_bodyB(this.entityB.body),t.set_localAnchorA(new b2Vec2(this.localAnchorA[0],this.localAnchorA[1])),t.set_localAnchorB(new b2Vec2(this.localAnchorB[0],this.localAnchorB[1])),t.set_collideConnected(this.collide)},n.export=function(){return{type:this.type,id:this.id,entityA:this.entityA.id,entityB:this.entityB.id,localAnchorA:this.localAnchorA,localAnchorB:this.localAnchorB,collide:this.collide}},n.import=function(t){this.entityA=_engine.getEntityById(t.entityA),this.entityB=_engine.getEntityById(t.entityB),this.localAnchorA=t.localAnchorA,this.localAnchorB=t.localAnchorB,this.collide=t.collide,this.id=t.id,_engine.addJoint(this,!0)};var o=function(t,i,o,s,r,a){n.call(this,e.exports.REVOLUTE,t,i,o,s,r,a),this.color="green"};o.prototype=new n,o.prototype.constructor=o,o.import=function(t){var e=new o;return n.import.call(e,t),e},o.prototype.export=function(){var t=n.export.call(this);return t},o.prototype.getDefinition=function(){var t=new b2RevoluteJointDef;return n.getDefinition.call(this,t),t},e.exports.Revolute=o;var s=function(t,i,o,s,r,a,p){n.call(this,e.exports.ROPE,t,i,o,s,r,p),this.maxLength=a,this.color="orange"};s.prototype=new n,s.prototype.constructor=s,s.import=function(t){var e=new s;return e.maxLength=t.maxLength,n.import.call(e,t),e},s.prototype.export=function(){var t=n.export.call(this);return t.maxLength=this.maxLength,t},s.prototype.getDefinition=function(){var t=new b2RopeJointDef;return n.getDefinition.call(this,t),t.set_maxLength(this.maxLength),t},e.exports.Rope=s},{}],19:[function(t,e,i){var n=t("./token.js").Logic,o=t("./translations.js"),s=t("./token.js").Literal,r=t("./typing.js").Type,a=t("./typing.js").FixType;e.exports=[];var p=function(t,e){n.call(this,"AND",r.BOOLEAN,arguments,[r.BOOLEAN,r.BOOLEAN]),this.fixType=a.INFIX,this.args.push(t),this.args.push(e)};p.prototype=new n,p.prototype.evaluate=function(){return this.args[0].evaluate()&&this.args[1].evaluate()},p.prototype.constructor=p,e.exports.push(p);var l=function(t,e){n.call(this,"OR",r.BOOLEAN,arguments,[r.BOOLEAN,r.BOOLEAN]),this.fixType=a.INFIX,this.args.push(t),this.args.push(e)};l.prototype=new n,l.prototype.evaluate=function(){return!(!this.args[0].evaluate()&&!this.args[1].evaluate())},l.prototype.constructor=l,e.exports.push(l);var h=function(t){n.call(this,"NOT",r.BOOLEAN,arguments,[r.BOOLEAN]),this.args.push(t)};h.prototype=new n,h.prototype.evaluate=function(){return!this.args[0].evaluate()},h.prototype.constructor=h,e.exports.push(h);var u=function(t){n.call(this,"text",r.STRING,arguments,[r.LITERAL]),this.args.push(t)};u.prototype=new n,u.prototype.evaluate=function(){return this.args[0].evaluate()},u.prototype.validate=function(){return!0},u.prototype.populate=function(){this.args[0]=new s(prompt(o.getTranslated("BEHAVIORS.INPUT_DIALOG")+this.name))},u.prototype.constructor=u,e.exports.push(u);var c=function(t){n.call(this,"number",r.NUMBER,arguments,[r.LITERAL]),this.args.push(t)};c.prototype=new n,c.prototype.evaluate=function(){return parseFloat(this.args[0].evaluate())},c.prototype.validate=function(){return $.isNumeric(this.args[0].evaluate())},c.prototype.populate=function(){this.args[0]=new s(prompt(o.getTranslated("BEHAVIORS.INPUT_DIALOG")+this.name))},c.prototype.constructor=c,e.exports.push(c);var d=function(){n.call(this,"true",r.BOOLEAN,arguments,[])};d.prototype=new n,d.prototype.evaluate=function(){return!0},d.prototype.constructor=d,e.exports.push(d);var g=function(t){n.call(this,"false",r.BOOLEAN,arguments,[])};g.prototype=new n,g.prototype.evaluate=function(){return!1},g.prototype.constructor=g,e.exports.push(g);var y=function(t){n.call(this,"isButtonDown",r.BOOLEAN,arguments,[r.NUMBER]),this.args.push(t)};y.prototype=new n,y.prototype.evaluate=function(){return _engine.input.keyboard.isDown(this.args[0].evaluate())},y.prototype.constructor=y,e.exports.push(y);var f=function(t){n.call(this,"isButtonUp",r.BOOLEAN,arguments,[r.NUMBER]),this.args.push(t)};f.prototype=new n,f.prototype.evaluate=function(){return _engine.input.keyboard.isUp(this.args[0].evaluate())},f.prototype.constructor=f,e.exports.push(f);var v=function(t,e){n.call(this,"randomNumber",r.NUMBER,arguments,[r.NUMBER,r.NUMBER]),this.args.push(t),this.args.push(e)};v.prototype=new n,v.prototype.evaluate=function(){return Utils.randomRange(this.args[0].evaluate()&&this.args[1].evaluate())},v.prototype.constructor=v,e.exports.push(v);var E=function(t){n.call(this,"getVelocityX",r.NUMBER,arguments,[r.ENTITYFILTER]),this.args.push(t)};E.prototype=new n,E.prototype.evaluate=function(){var t=this.args[0].filter()[0];return t.body.GetLinearVelocity().get_x()},E.prototype.constructor=E,e.exports.push(E);var m=function(t){n.call(this,"getVelocityY",r.NUMBER,arguments,[r.ENTITYFILTER]),this.args.push(t)};m.prototype=new n,m.prototype.evaluate=function(){var t=this.args[0].filter()[0];return t.body.GetLinearVelocity().get_y()},m.prototype.constructor=m,e.exports.push(m);var T=function(t,e){n.call(this,"+",r.NUMBER,arguments,[r.NUMBER,r.NUMBER]),this.args.push(t),this.args.push(e),this.fixType=a.INFIX};T.prototype=new n,T.prototype.evaluate=function(){return this.args[0].evaluate()+this.args[1].evaluate()},T.prototype.constructor=T,e.exports.push(T);var _=function(t,e){n.call(this,"*",r.NUMBER,arguments,[r.NUMBER,r.NUMBER]),this.args.push(t),this.args.push(e),this.fixType=a.INFIX};_.prototype=new n,_.prototype.evaluate=function(){return this.args[0].evaluate()*this.args[1].evaluate()},_.prototype.constructor=_,e.exports.push(_);var I=function(t,e){n.call(this,"/",r.NUMBER,arguments,[r.NUMBER,r.NUMBER]),this.args.push(t),this.args.push(e),this.fixType=a.INFIX};I.prototype=new n,I.prototype.evaluate=function(){return this.args[0].evaluate()/this.args[1].evaluate()},I.prototype.constructor=I,e.exports.push(I);var O=function(t,e){n.call(this,"-",r.NUMBER,arguments,[r.NUMBER,r.NUMBER]),this.args.push(t),this.args.push(e),this.fixType=a.INFIX};O.prototype=new n,O.prototype.evaluate=function(){return this.args[0].evaluate()+this.args[1].evaluate()},O.prototype.constructor=O,e.exports.push(O);var S=function(t,e){n.call(this,">",r.BOOLEAN,arguments,[r.NUMBER,r.NUMBER]),this.args.push(t),this.args.push(e),this.fixType=a.INFIX};S.prototype=new n,S.prototype.evaluate=function(){return this.args[0].evaluate()>this.args[1].evaluate()},S.prototype.constructor=S,e.exports.push(S);var A=function(t,e){n.call(this,"<",r.BOOLEAN,arguments,[r.NUMBER,r.NUMBER]),this.args.push(t),this.args.push(e),this.fixType=a.INFIX};A.prototype=new n,A.prototype.evaluate=function(){return this.args[0].evaluate()<this.args[1].evaluate()},A.prototype.constructor=A,e.exports.push(A)},{"./token.js":24,"./translations.js":27,"./typing.js":28}],20:[function(t,e,i){var n=(t("./typing").FixType,t("./typing").Type),o=t("./token.js").Literal,s=function(t){this.tokenManager=t,this.parserInput="",this.parserInputWhole="",this.parserStack=[]};s.prototype.fail=function(t){throw t+"\nRemaining input: "+this.parserInput},s.prototype.currentChar=function(){return this.parserInput.length?this.parserInput[0]:""},s.prototype.nextChar=function(){return this.parserInput[1]},s.prototype.removeChar=function(){this.parserInput=this.parserInput.slice(1)},s.prototype.readChar=function(){var t=this.currentChar();return this.removeChar(),t},s.prototype.readWhitespace=function(){for(;" "===this.currentChar();)this.removeChar()},s.prototype.readName=function(){this.readWhitespace();for(var t="";/[^ ,)("]/.test(this.currentChar());)t+=this.readChar();if('"'===this.currentChar()){for(this.readChar();'"'!==this.currentChar();)"\\"===this.currentChar()&&'"'===this.nextChar()?(this.readChar(),this.readChar(),t+='"'):t+=this.readChar();this.readChar()}else""===t&&(t=!1);return this.readWhitespace(),t},s.prototype.readParentheses=function(){if(this.readWhitespace(),"("===this.currentChar()){for(this.readChar();")"!==this.currentChar();)this.readWhitespace(),this.parseToken(),this.readWhitespace(),","===this.currentChar()&&(this.readChar(),this.readWhitespace());this.readChar()}},s.prototype.parseToken=function(){this.readParentheses();var t=this.readName();if(t!==!1){var e=this.tokenManager.getTokenByName(t);if(e=void 0===e?new o(t):new e.constructor,this.readParentheses(),e.type!==n.LITERAL)for(var i=e.argument_types.length-1;i>=0;i--){var s=this.parserStack.pop();e.argument_types[i]!==s.type&&this.fail("Expected "+e.argument_types[i]+", got "+s.type),e.args[i]=s}return this.parserStack.push(e),e}},s.prototype.parse=function(t){return this.parserInput=t,this.parserInputWhole=t,this.parserStack=[],this.parseToken()},e.exports=s},{"./token.js":24,"./typing":28}],21:[function(t,e,i){var n=t("./utils.js"),o=t("./firebase.js"),s=t("./updateEvent.js"),r=t("./LSManager.js"),a={saveCurrent:function(){"undefined"!=typeof _engine&&r.set("data",JSON.stringify(_engine.stateManager.getCurrentState()),"currentState")},saveRemote:function(){var t=n.generateUUID(),e=JSON.stringify(_engine.stateManager.getCurrentState());return o.ref("saved/"+t).set({data:e,created:Date.now(),accessed:Date.now()}).then(function(){return t})},saveLocal:function(t){t=void 0==t||""===t?n.generateUUID():t;var e=150,i=100,o=new Image;o.src=_engine.viewport.canvasElement.toDataURL(),o.onload=function(){var n=el("canvas",{width:e,height:i}),s=n.getContext("2d"),a=o.width*(i/e),p=(o.height-a)/2;s.drawImage(o,0,p,o.width,a,0,0,e,i),r.set(t,n.toDataURL(),"savedScreenshots")},r.set(t,JSON.stringify(_engine.stateManager.getCurrentState()))},loadCurrent:function(){var t=r.get("data","currentState");t?this.load(t):_engine.stateManager.addState()},loadRemote:function(t){return""===t||/\.|\#|\$|\[|\]/.test(t)?{then:function(t){return t(!1)}}:o.ref("/saved/"+t).once("value").then(function(e){var i=""!==t&&null!==e.val();return i&&(this.load(e.val().data),o.ref("saved/"+t).update({accessed:Date.now()})),i}.bind(this))},loadLocal:function(t){this.load(r.get(t))},getLocalSaves:function(){return r.getObj()},getLocalSaveScreenshot:function(t){return r.get(t,"savedScreenshots")},load:function(t){t="string"==typeof t?JSON.parse(t):t,_engine.stateManager.addState(t),_engine.stateManager.buildState(_engine.stateManager.getCurrentState())},removeLocal:function(t){r.remove(t),r.remove(t,"savedScreenshots")}};$(document).on("update",function(t){t.detail.action===s.STATE_CHANGE&&a.saveCurrent();
}),e.exports=a},{"./LSManager.js":1,"./firebase.js":15,"./updateEvent.js":29,"./utils.js":30}],22:[function(t,e,i){function n(){p.fire(p.RESIZE,{entities:[_engine.selected.ptr],noState:!0}),p.fire(p.ROTATE,{entities:[_engine.selected.ptr],noState:!0}),p.fire(p.REPOSITION,{entities:[_engine.selected.ptr]}),_engine.selected.ptr.toggleHelpers(!1)}var o=t("./entity.js"),s=t("./constants.js"),r=t("./clickableHelper.js"),a=t("./geometry.js"),p=t("./updateEvent.js"),l=function(t,e,i,n,s){t=void 0==t?new b2Vec2(0,0):t,e=void 0==e?1:e,i=void 0==i?new b2FixtureDef:i;var r=new b2CircleShape;r.set_m_radius(e);var a=new b2BodyDef;return a.set_position(t),o.call(this,r,i,a,n,s),this.radius=e,this.type="CIRCLE",this};l.prototype=new o,l.prototype.constructor=l,l.import=function(t){var e=new l;return o.import.call(e,t),e.resize(t.width/2,!0),e},l.prototype.export=function(){return o.export.call(this)},l.prototype.getWidth=function(){return 2*this.radius},l.prototype.getHeight=function(){return 2*this.radius},l.prototype.addHelpers=function(){this.helpers=[new r(this,15,15,s.POSITION_TOP_RIGHT,"img/resize-sw-ne.svg",this.moveResize,this.startResize,n),new r(this,15,15,s.POSITION_TOP_LEFT,"img/rotate.svg",this.moveRotate,this.startRotate,n)]},l.prototype.draw=function(t){t.beginPath(),t.arc(0,0,_engine.viewport.fromScale(this.radius),0,2*Math.PI,!1),t.closePath(),t.fill(),t.strokeStyle="red",t.globalCompositeOperation="destination-out",t.beginPath(),t.moveTo(0,0),t.lineTo(0,_engine.viewport.fromScale(this.radius)),t.closePath(),t.stroke()},l.prototype.startResize=function(){this.startSize=this.entity.getWidth()/2,this.startDistance=a.pointPointDistance(new b2Vec2(this.entity.getX(),this.entity.getY()),new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y)),this.entity.toggleHelpers(!1)},l.prototype.moveResize=function(){var t=a.pointPointDistance(new b2Vec2(this.entity.getX(),this.entity.getY()),new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y))/this.startDistance;this.entity.resize(this.startSize*t,!0)},l.prototype.resize=function(t,e){if(t<s.SHAPE_MIN_SIZE/2)return!1;var i=new b2FixtureDef;i.set_density(this.fixture.GetDensity()),i.set_friction(this.fixture.GetFriction()),i.set_restitution(this.fixture.GetRestitution()),i.set_filter(this.fixture.GetFilterData());var n=new b2CircleShape;return n.set_m_radius(t),this.radius=t,i.set_shape(n),this.body.DestroyFixture(this.fixture),this.fixture=this.body.CreateFixture(i),this.recalculateHelpers(),e||p.fire(p.RESIZE,{entities:[this]}),!0};var h=function(t,e,i,n,s){t=void 0==t?new b2Vec2(0,0):t,e=void 0==e?new b2Vec2(1,1):e,i=void 0==i?new b2FixtureDef:i;var r=new b2PolygonShape;r.SetAsBox(e.get_x(),e.get_y());var a=new b2BodyDef;return a.set_position(t),o.call(this,r,i,a,n,s),this.extents=e,this.type="RECTANGLE",this};h.prototype=new o,h.prototype.constructor=h,h.import=function(t){var e=new h;return o.import.call(e,t),e.resize(t.width/2,t.height/2,!0),e},h.prototype.export=function(){return o.export.call(this)},h.prototype.getWidth=function(){return 2*this.extents.get_x()},h.prototype.getHeight=function(){return 2*this.extents.get_y()},h.prototype.addHelpers=function(){this.helpers=[new r(this,15,15,s.POSITION_TOP_RIGHT,"img/resize-sw-ne.svg",this.moveResize,this.startResize,n),new r(this,15,15,s.POSITION_TOP_LEFT,"img/rotate.svg",this.moveRotate,this.startRotate,n),new r(this,7,7,s.POSITION_BOTTOM,"img/handle.svg",this.moveResizeSide,this.startResizeSide,n),new r(this,7,7,s.POSITION_TOP,"img/handle.svg",this.moveResizeSide,this.startResizeSide,n),new r(this,7,7,s.POSITION_LEFT,"img/handle.svg",this.moveResizeSide,this.startResizeSide,n),new r(this,7,7,s.POSITION_RIGHT,"img/handle.svg",this.moveResizeSide,this.startResizeSide,n)]},h.prototype.draw=function(t){var e=_engine.viewport.fromScale(this.extents.get_x()),i=_engine.viewport.fromScale(this.extents.get_y());t.fillRect(-e,-i,2*e,2*i)},h.prototype.startResizeSide=function(){this.startSize=[this.entity.getWidth()/2,this.entity.getHeight()/2],this.startPosition=new b2Vec2(this.entity.getX(),this.entity.getY()),this.entity.toggleHelpers(!1)},h.prototype.moveResizeSide=function(){var t=a.pointRotate(this.startPosition,new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y),-(this.entity.getAngle()+s.sideOrder.equalIndexOf(this.position)*(Math.PI/2))),e=this.startPosition.get_y()-t.get_y();this.entity.resize((this.startSize[0]+this.startSize[0]*Math.abs(this.position[1])+e*Math.abs(this.position[0]))/2,(this.startSize[1]+this.startSize[1]*Math.abs(this.position[0])+e*Math.abs(this.position[1]))/2,!0)&&this.entity.setPosition(a.pointRotate(this.startPosition,new b2Vec2(this.startPosition.get_x()+(e-this.startSize[0])/2*this.position[0],this.startPosition.get_y()+(e-this.startSize[1])/2*this.position[1]),this.entity.getAngle()),null,!0)},h.prototype.startResize=function(){this.startSize=[this.entity.getWidth()/2,this.entity.getHeight()/2],this.startDistance=a.pointPointDistance(this.entity.getPosition(),new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y)),this.entity.toggleHelpers(!1)},h.prototype.moveResize=function(){var t=a.pointPointDistance(this.entity.getPosition(),new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y))/this.startDistance;this.entity.resize(this.startSize[0]*t,this.startSize[1]*t,!0)},h.prototype.resize=function(t,e,i){if(2*t<s.SHAPE_MIN_SIZE||2*e<s.SHAPE_MIN_SIZE)return!1;var n=new b2FixtureDef;n.set_density(this.fixture.GetDensity()),n.set_friction(this.fixture.GetFriction()),n.set_restitution(this.fixture.GetRestitution()),n.set_filter(this.fixture.GetFilterData());var o=new b2PolygonShape;return o.SetAsBox(t,e),this.extents=new b2Vec2(t,e),n.set_shape(o),this.body.DestroyFixture(this.fixture),this.fixture=this.body.CreateFixture(n),this.recalculateHelpers(),i||p.fire(p.RESIZE,{entities:[this]}),!0},e.exports.Circle=l,e.exports.Rectangle=h},{"./clickableHelper.js":9,"./constants.js":10,"./entity.js":12,"./geometry.js":16,"./updateEvent.js":29}],23:[function(t,e,i){var n=t("./constants.js"),o=t("./shapes.js"),s=(t("./behavior.js"),t("./updateEvent.js")),r=t("./joints.js"),a=function(t){this.engine=t,this.stateStack=[],this.currentState=-1};a.prototype.getCurrentState=function(){return this.stateStack[this.currentState]},a.prototype.addState=function(t){t=t?t:this.createState(),this.currentState+=1,this.stateStack.splice(this.currentState,this.stateStack.length-this.currentState,t),this.stateStack.length>n.STATE_STACK_SIZE&&(this.stateStack.shift(),this.currentState-=1),s.fire(s.STATE_CHANGE,{noState:!0,first:0===this.currentState,last:this.currentState===this.stateStack.length-1})},a.prototype.createState=function(){var t={};t.world={gravity:[this.engine.world.GetGravity().get_x(),this.engine.world.GetGravity().get_y()],collisionGroups:JSON.parse(JSON.stringify(this.engine.collisionGroups)),camera:[this.engine.viewport.x,this.engine.viewport.y],lifetimeEntities:this.engine.lifetimeEntities,cameraStyle:this.engine.viewport.getCameraStyle(),cameraEntityId:this.engine.viewport.getCameraEntityId()},t.layers=[];for(var e=0;e<n.LAYERS_NUMBER;e++){t.layers.push([]);for(var i=0;i<this.engine.layers[e].length;i++)t.layers[e].push(this.engine.layers[e][i].export())}return t.joints=_.map(this.engine.joints,function(t){return t.export()}),t},a.prototype.buildState=function(t){this.clearWorld(!0),this.engine.setGravity(t.world.gravity[0],t.world.gravity[1],!0),this.engine.collisionGroups=t.world.collisionGroups,this.engine.viewport.x=t.world.camera[0],this.engine.viewport.y=t.world.camera[1],this.engine.viewport.setCameraStyle(t.world.cameraStyle,!0),this.engine.viewport.setCameraEntityId(t.world.cameraEntityId,!0);for(var e=0;e<t.layers.length;e++)for(var i=0;i<t.layers[e].length;i++){var n,a=t.layers[e][i];switch(a.type){case"CIRCLE":n=o.Circle.import(a);break;case"RECTANGLE":n=o.Rectangle.import(a)}this.engine.setEntityLayer(n,e,!0)}for(var p=0;p<t.joints.length;p++){var l=t.joints[p];switch(l.type){case r.REVOLUTE:r.Revolute.import(l);break;case r.ROPE:r.Rope.import(l)}}this.engine.lifetimeEntities=t.world.lifetimeEntities,s.fire(s.STATE_CHANGE,{noState:!0,first:0===this.currentState,last:this.currentState===this.stateStack.length-1})},a.prototype.undo=function(){0!==this.currentState&&(this.currentState-=1,this.buildState(this.stateStack[this.currentState]))},a.prototype.redo=function(){this.currentState!==this.stateStack.length-1&&(this.currentState+=1,this.buildState(this.stateStack[this.currentState]))},a.prototype.clearWorld=function(t){for(var e=this.engine.entities(),i=0;i<e.length;i++)this.engine.removeEntity(e[i],!0);_engine.joints=[],this.engine.lifetimeEntities=0,this.engine.lifetimeJoints=0,t||s.fire(s.WORLD_CLEARED)},e.exports=a},{"./behavior.js":5,"./constants.js":10,"./joints.js":18,"./shapes.js":22,"./updateEvent.js":29}],24:[function(t,e,i){var n=t("./typing.js").FixType,o=t("./typing.js").Type,s=function(t,e,i,o){this.type=e,this.fixType=n.PREFIX,this.name=t,this.args=void 0==i?[]:i,this.argument_types=o,this.args=[]};s.prototype.toString=function(){for(var t="",e=[],i=0;i<this.args.length;i++)e.push(this.args[i].toString());switch(e=e.join(", "),this.fixType){case n.PREFIX:t=this.name+"("+e+")";break;case n.INFIX:t="("+this.args[0].toString()+")"+this.name+"("+this.args[1].toString()+")"}return t};var r=function(t){this.type=o.LITERAL,this.value=t};r.prototype.toString=function(){return'"'+this.value+'"'},r.prototype.evaluate=function(){return this.value};var a=function(t,e,i,n){s.call(this,t,e,i,n)};a.prototype=new s,a.prototype.constructor=a,a.prototype.evaluate=function(){return!1};var p=function(t,e,i){s.call(this,t,o.ACTION,e,i)};p.prototype=new s,p.prototype.constructor=p,p.prototype.each=function(t){return!1},p.prototype.execute=function(){for(var t=this.args[0].filter(),e=0;e<t.length;e++)this.each(t[e])};var l=function(t,e,i){s.call(this,t,o.ENTITYFILTER,e,i)};l.prototype=new s,l.prototype.constructor=l,l.prototype.decide=function(t){return!1},l.prototype.filter=function(){for(var t=[],e=_engine.entities(),i=0;i<e.length;i++)this.decide(e[i])&&t.push(e[i]);return t},e.exports.Token=s,e.exports.Literal=r,e.exports.Action=p,e.exports.Logic=a,e.exports.EntityFilter=l},{"./typing.js":28}],25:[function(t,e,i){var n=t("./parser.js"),o=function(){this.tokens=[],this.registerTokens(t("./logic.js")),this.registerTokens(t("./actions.js")),this.registerTokens(t("./entityFilters.js")),this.parser=new n(this)};o.prototype.registerTokens=function(t){t.forEach(function(t){this.tokens.push(new t)},this)},o.prototype.getTokenByName=function(t){for(var e=0;e<this.tokens.length;e++)if(this.tokens[e].name===t)return this.tokens[e]},o.prototype.getTokensByType=function(t){var e=[];return this.tokens.forEach(function(i){i.type===t&&e.push(i)}),e},e.exports=o},{"./actions.js":4,"./entityFilters.js":13,"./logic.js":19,"./parser.js":20}],26:[function(t,e,i){var n=t("./shapes.js"),o=t("./bodyType.js"),s=t("./constants.js"),r=t("./updateEvent.js"),a={onclick:function(){},onrelease:function(){},onmove:function(){}},p={origin:null,offset:null,mode:null,onclick:function(){if("entity"===_engine.selected.type)for(var t=_engine.selected.ptr.helpers.length-1;t>=0;t--)if(_engine.selected.ptr.helpers[t].testPoint(_engine.input.mouse.x,_engine.input.mouse.y))return void _engine.selected.ptr.helpers[t].click();_engine.selectEntity(null,!0);for(var t=s.LAYERS_NUMBER-1;t>=0;t--)for(var e=0;e<_engine.layers[t].length;e++)if(_engine.layers[t][e].fixture.TestPoint(new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y)))return"entity-pick"===this.mode?(r.fire(r.ENTITY_PICKED,{noState:!0,entityId:_engine.layers[t][e].id}),void(this.mode="")):(_engine.selectEntity(_engine.layers[t][e]),this.origin=[_engine.input.mouse.x,_engine.input.mouse.y],this.offset=[_engine.selected.ptr.body.GetPosition().get_x()-this.origin[0],_engine.selected.ptr.body.GetPosition().get_y()-this.origin[1]],this.mode="reposition-start",this.origin=[_engine.input.mouse.x,_engine.input.mouse.y],void _engine.selected.ptr.toggleHelpers(!1));"entity-pick"!==this.mode&&(this.mode="camera",this.origin=[_engine.viewport.x,_engine.viewport.y],this.offset=[_engine.input.mouse.canvasX,_engine.input.mouse.canvasY],_engine.viewport.canvasElement.style.cursor="url(img/grabbingcursor.png), move")},onrelease:function(){"entity-pick"!==this.mode&&("reposition"===this.mode&&(_engine.selected.ptr.toggleHelpers(!0),r.fire(r.REPOSITION,{entities:[_engine.selected.ptr]})),"reposition-start"===this.mode&&_engine.selected.ptr.toggleHelpers(!0),"camera"===this.mode&&r.fire(r.CAMERA_MOVE),this.origin=this.offset=this.mode=null,_engine.viewport.canvasElement.style.cursor="default")},onmove:function(){if(null!==this.mode&&("camera"===this.mode&&(_engine.viewport.x=this.origin[0]+_engine.viewport.toScale(this.offset[0]-_engine.input.mouse.canvasX),_engine.viewport.y=this.origin[1]+_engine.viewport.toScale(this.offset[1]-_engine.input.mouse.canvasY)),"reposition-start"!==this.mode||this.origin.equalTo([_engine.input.mouse.x,_engine.input.mouse.y])||(this.mode="reposition"),"reposition"===this.mode)){var t=Math.round(1e3*(_engine.input.mouse.x+this.offset[0]))/1e3,e=Math.round(1e3*(_engine.input.mouse.y+this.offset[1]))/1e3;_engine.selected.ptr.setPosition(t,e,!0)}}},l={origin:null,worldOrigin:null,w:0,h:0,onclick:function(){this.onmove=this.dragging,this.origin=[_engine.input.mouse.canvasX,_engine.input.mouse.canvasY],this.worldOrigin=[_engine.input.mouse.x,_engine.input.mouse.y]},onrelease:function(){if(this.w>=_engine.viewport.fromScale(s.SHAPE_MIN_SIZE)&&this.h>=_engine.viewport.fromScale(s.SHAPE_MIN_SIZE)){this.w*=_engine.viewport.scale,this.h*=_engine.viewport.scale;var t=Math.min(_engine.input.mouse.x,this.worldOrigin[0]),e=Math.min(_engine.input.mouse.y,this.worldOrigin[1]);_engine.addEntity(new n.Rectangle(new b2Vec2(t+this.w/2,e+this.h/2),new b2Vec2(this.w/2,this.h/2)),o.DYNAMIC_BODY)}this.onmove=function(){},this.origin=null,this.worldOrigin=null,this.w=this.h=0},onmove:function(){},dragging:function(t){this.w=Math.abs(_engine.input.mouse.canvasX-this.origin[0]),this.h=Math.abs(_engine.input.mouse.canvasY-this.origin[1]),t.fillStyle="rgba(0, 0, 0, 0.4)",(this.w<_engine.viewport.fromScale(s.SHAPE_MIN_SIZE)||this.h<_engine.viewport.fromScale(s.SHAPE_MIN_SIZE))&&(t.fillStyle="rgba(255, 0, 0, 0.4)"),t.save(),t.fillRect(Math.min(_engine.input.mouse.canvasX,this.origin[0]),Math.min(_engine.input.mouse.canvasY,this.origin[1]),this.w,this.h),t.restore()}},h={origin:null,worldOrigin:null,radius:0,onclick:function(){this.onmove=this.dragging,this.origin=[_engine.input.mouse.canvasX,_engine.input.mouse.canvasY],this.worldOrigin=[_engine.input.mouse.x,_engine.input.mouse.y]},onrelease:function(){if(this.radius>=_engine.viewport.fromScale(s.SHAPE_MIN_SIZE)/2){this.radius*=_engine.viewport.scale;var t=Math.min(this.worldOrigin[0],_engine.input.mouse.x),e=Math.min(this.worldOrigin[1],_engine.input.mouse.y);_engine.addEntity(new n.Circle(new b2Vec2(t+this.radius,e+this.radius),this.radius),o.DYNAMIC_BODY)}this.onmove=function(){},this.origin=null,this.worldOrigin=null,this.radius=0},onmove:function(){},dragging:function(t){this.radius=Math.min(Math.abs(_engine.input.mouse.canvasX-this.origin[0]),Math.abs(_engine.input.mouse.canvasY-this.origin[1]))/2,t.fillStyle="rgba(0, 0, 0, 0.4)",this.radius<_engine.viewport.fromScale(s.SHAPE_MIN_SIZE)/2&&(t.fillStyle="rgba(255, 0, 0, 0.4)"),t.save(),t.beginPath();var e=Math.min(this.origin[0],_engine.input.mouse.canvasX),i=Math.min(this.origin[1],_engine.input.mouse.canvasY);t.arc(e+this.radius,i+this.radius,this.radius,0,2*Math.PI,!1),t.fill(),t.restore()}};e.exports.Blank=a,e.exports.Selection=p,e.exports.Rectangle=l,e.exports.Circle=h},{"./bodyType.js":7,"./constants.js":10,"./shapes.js":22,"./updateEvent.js":29}],27:[function(t,e,i){e.exports={strings:[t("../translations/english.js"),t("../translations/slovak.js")],currentLanguage:0,getTranslated:function(t,e){void 0==e&&(e=this.currentLanguage);for(var i=this.strings[e],n=t.split("."),o=0;o<n.length;++o){var s=n[o];if(!(s in i))throw"ERROR! No translation for "+t;i=i[s]}return i},getTranslatedWrapped:function(t,e){var i=el("span",{translation:t});return i.innerHTML=this.getTranslated(t,e),i},setLanguage:function(t){this.currentLanguage=t;for(var e=document.querySelectorAll("[translation]"),i=0;i<e.length;i++)e[i].innerHTML=this.getTranslated(e[i].getAttribute("translation"))},refresh:function(){this.setLanguage(this.currentLanguage)}}},{"../translations/english.js":32,"../translations/slovak.js":33}],28:[function(t,e,i){var n={BOOLEAN:"boolean",NUMBER:"number",STRING:"string",ARRAY:"array",ACTION:"action",ENTITYFILTER:"entityFilter",LITERAL:"literal"},o={INFIX:"infix",PREFIX:"prefix"};e.exports.Type=n,e.exports.FixType=o},{}],29:[function(t,e,i){var n={fire:function(t,e){e=$.extend({},e),e.action=t;var i=new CustomEvent("update",{detail:e});return document.dispatchEvent(i),console.log(t,void 0==e.noState||null),i},RESIZE:"resize",ROTATE:"rotate",ROTATION_LOCKED:"rotation_locked",REPOSITION:"reposition",ID_CHANGE:"id_change",COL_GROUP_CHANGE:"col_group_change",LAYER_CHANGE:"layer_change",FRICTION_CHANGE:"friction_change",RESTITUTION_CHANGE:"restitution_change",DENSITY_CHANGE:"density_change",COLOR_CHANGE:"color_change",BODY_TYPE_CHANGE:"body_type_change",BEHAVIOR_CHANGE:"behavior_change",ENTITY_ADD:"entity_add",ENTITY_DELETE:"entity_delete",STATE_CHANGE:"state_change",WORLD_CLEARED:"world_cleared",GRAVITY_CHANGE:"gravity_change",CAMERA_STYLE_CHANGE:"camera_style_change",CAMERA_MOVE:"camera_move",CAMERA_ENTITY_CHANGE:"camera_entity_change",SELECTION_CHANGE:"selection_change",JOINT_ADD:"joint_add",JOINT_REMOVE:"joint_remove",ENTITY_PICKED:"entity_picked"};e.exports=n},{}],30:[function(t,e,i){var n={getBrowserWidth:function(){return $(".ui.content").outerWidth()},getBrowserHeight:function(){return $(".ui.content").outerHeight()},randomRange:function(t,e){return Math.floor(Math.random()*(e-t)+t)},generateUUID:function(){var t=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(t+=performance.now());var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)});return e}};Array.prototype.equalTo=function(t){if(this.length!=t.length)return!1;for(var e=0;e<t.length;e++)if(this[e].equalTo){if(!this[e].equalTo(t[e]))return!1}else if(this[e]!==t[e])return!1;return!0},Array.prototype.equalIndexOf=function(t){for(var e=0;e<this.length;e++){if(this[e]===t)return e;if(Array.isArray(t)&&Array.isArray(this[e])&&this[e].equalTo(t))return e}return-1},e.exports=n},{}],31:[function(t,e,i){var n=t("./utils.js"),o=t("./constants.js"),s=t("./cameraStyle.js"),r=t("./updateEvent.js"),a=function(t,e,i,n,r){this.scale=o.DEFAULT_SCALE,this.cameraStyle=s.FIXED,this.cameraEntityId="",void 0!=e&&void 0!=i?(this.setAutoResize(!1),this.width=e,this.height=i):(this.setAutoResize(!0),this.autoResize()),void 0!==n&&void 0!==r?(this.x=n,this.y=r):(this.x=0,this.y=0),this.canvasElement=t,void 0===t&&(this.canvasElement=document.createElement("canvas"),document.body.appendChild(this.canvasElement)),this.resetElement(),this.context=this.canvasElement.getContext("2d")};a.prototype.resetElement=function(){this.canvasElement.width=this.width,this.canvasElement.height=this.height},a.prototype.autoResize=function(){this.width=n.getBrowserWidth(),this.height=n.getBrowserHeight()},a.prototype.setAutoResize=function(t){if(this.autoResizeActive=t,this.autoResizeActive){var e=this;window.onresize=function(){e.autoResize(),e.resetElement()}}else window.onresize=null},a.prototype.zoom=function(t){var e=1.5;this.scale=o.DEFAULT_SCALE/Math.pow(e,6)*Math.pow(e,12-t),_engine.selected.ptr&&_engine.selected.ptr.recalculateHelpers()},a.prototype.getOffset=function(){return[this.x-this.width/2,this.y-this.height/2]},a.prototype.getCameraEntityId=function(){return this.cameraEntityId},a.prototype.setCameraEntityId=function(t,e){this.cameraEntityId=t,e||r.fire(r.CAMERA_ENTITY_CHANGE)},a.prototype.getCameraStyle=function(){return this.cameraStyle!==s.ENTITY||_engine.getEntityById(this.getCameraEntityId())||(this.cameraStyle=s.FIXED,this.cameraEntityId=""),this.cameraStyle},a.prototype.setCameraStyle=function(t,e){this.cameraStyle=t,e||r.fire(r.CAMERA_STYLE_CHANGE)},a.prototype.toScale=function(t){return t*this.scale},a.prototype.fromScale=function(t){return t/this.scale},e.exports=a},{"./cameraStyle.js":8,"./constants.js":10,"./updateEvent.js":29,"./utils.js":30}],32:[function(t,e,i){e.exports={LANGUAGE_NAME:"English",LANGUAGE_TOOLTIP:"Changes the language",COLLISION_GROUPS:"Collision groups",COLLISION_GROUPS_TOOLTIP:"Sets which object groups should collide with each other",START:"Start",STOP:"Stop",START_TOOLTIP:"Starts the simulation",STOP_TOOLTIP:"Stops the simulation",CLEAR_WORLD_TOOLTIP:"Removes all objects from the scene",SAVE:"Save",LOAD:"Load",SAVE_TOOLTIP:"Saves the scene and provides a sharing code",LOAD_TOOLTIP:"Loads a scene from the computer or a sharing code",UNDO:"Undo",REDO:"Redo",LAYER:"Layer ",ZOOM:"Zoom: ",TOOL:"Tool: ",RECTANGLE:"Rectangle",CIRCLE:"Circle",RECTANGLE_TOOL:"Rectangle tool",CIRCLE_TOOL:"Circle tool",SELECTION_TOOL:"Selection tool",NO_ENTITY_WITH_ID:"No object exists with this ID.",SAVEUI:{TITLE:"Scene saving",SAVE_BUTTON:"Save",NAME:"Name of the scene: ",SHARE_CODE:"Sharing code: ",GENERATE:"Generate",SAVE_LOCAL:"Save to this computer",SAVE_REMOTE:"Save to the internet",SHARE_LINK:"Sharing link: "},LOADUI:{TITLE:"Scene loading",LOAD_BUTTON:"Load",REMOVE_BUTTON:"Remove",SHARE_CODE:"Sharing code: ",INVALID_CODE:"This sharing code doesn't exist.",CONFIRM_DELETE:"Are you sure you want to delete the saved state ",LOAD_LOCAL:"Load from this computer",LOAD_REMOTE:"Load from the internet",NO_LOCAL:"There are no scenes saved to this computer"},BEHAVIORS:{TITLE:"Behavior editor",CONDITION:"When the following conditon is met:",INPUT_DIALOG:"Insert a correct value for ",ACTION:"Do this:",ANOTHER_ACTION:"And this:",NEW_ACTION:"Add new action",NEW_BEHAVIOR:"Add new behavior",REMOVE_ACTION:"Remove action",REMOVE_BEHAVIOR:"Remove behavior",DONE_BUTTON:"Done",CANCEL_BUTTON:"Cancel"},SIDEBAR:{ID:"ID:",COLLISION_GROUP:"Collision group:",X:"X-axis position:",Y:"Y-axis position:",WIDTH:"Width:",HEIGHT:"Height:",ROTATION:"Rotation:",FIXED_ROTATION:"Fixed rotation:",RESTITUTION:"Restitution:",FRICTION:"Friction:",DENSITY:"Density:",COLOR:"Color:",LAYER:"Layer:",DELETE_BUTTON:"Delete object",DELETE_CONFIRM:"Are you sure you want to delete this object?",SET_BEHAVIORS:"Set behavior",BODY_TYPE:"Body type:",BODY_TYPES:{DYNAMIC:"Dynamic",STATIC:"Static",KINEMATIC:"Kinematic"},GRAVITY_X:"X-axis gravity strength:",GRAVITY_Y:"Y-axis gravity strength:",CAMERA_STYLE:"Camera style:",CAMERA_STYLES:{FIXED:"Locked on point",ENTITY:"Locked on entity"},CAMERA_X:"X-axis camera position",CAMERA_Y:"Y-axis camera position",CAMERA_ENTITY:"Object ID for camera lock:"}}},{}],33:[function(t,e,i){e.exports={LANGUAGE_NAME:"Slovensky",LANGUAGE_TOOLTIP:"Zmena jazyku",COLLISION_GROUPS:"Skupiny pre kolzie",COLLISION_GROUPS_TOOLTIP:"Nastav, ktor skupiny objektov maj navzjom kolidova",START:"tart",STOP:"Stop",START_TOOLTIP:"Spust simulciu",STOP_TOOLTIP:"Ukon simulciu",CLEAR_WORLD_TOOLTIP:"Odstrni vetky objekty zo scny",SAVE:"Uloi",LOAD:"Nata",SAVE_TOOLTIP:"Ulo scnu a poskytne kd pre zdieanie",LOAD_TOOLTIP:"Nata scnu z potaa alebo kdu pre zdieanie",UNDO:"Krok sp",REDO:"Krok vpred",LAYER:"Vrstva ",ZOOM:"Priblenie: ",TOOL:"Nstroj: ",RECTANGLE:"Obdnik",CIRCLE:"Kruh",SELECTION_TOOL:"Nstroj vberu",CIRCLE_TOOL:"Nstroj kruh",RECTANGLE_TOOL:"Nstroj obdnik",NO_ENTITY_WITH_ID:"Neexistuje iadny objekt s tmto ID.",SAVEUI:{TITLE:"Ukladanie scny",SAVE_BUTTON:"Uloi",NAME:"Nzov scny: ",SHARE_CODE:"Kd pre zdieanie: ",GENERATE:"Vygenerova",SAVE_LOCAL:"Uloi v tomto potai",SAVE_REMOTE:"Uloi na internet",SHARE_LINK:"Odkaz pre zdieanie: "},LOADUI:{TITLE:"Natanie scny",LOAD_BUTTON:"Nata",REMOVE_BUTTON:"Odstrni",SHARE_CODE:"Kd pre zdieanie: ",INVALID_CODE:"Zadan kd pre zdieanie neexistuje.",CONFIRM_DELETE:"Naozaj chcete odstrni uloen stav ",LOAD_LOCAL:"Nata z tohoto potaa",LOAD_REMOTE:"Nata z internetu",NO_LOCAL:"Na tomto potai nie s uloen iadne scny"},BEHAVIORS:{TITLE:"Editor sprvania",CONDITION:"Ke plat nasledujca podmienka:",INPUT_DIALOG:"Zadajte korektn hodnotu pre ",ACTION:"Sprav toto:",ANOTHER_ACTION:"A toto:",NEW_ACTION:"Prida nov akciu",NEW_BEHAVIOR:"Prida nov podmienku",REMOVE_ACTION:"Odstrni akciu",REMOVE_BEHAVIOR:"Odstrni podmienku",DONE_BUTTON:"Hotovo",CANCEL_BUTTON:"Zrui"},SIDEBAR:{ID:"ID:",COLLISION_GROUP:"Skupina pre kolzie:",X:"Pozcia na osi X:",Y:"Pozcia na osi Y:",WIDTH:"rka:",HEIGHT:"Vka:",ROTATION:"Rotcia:",FIXED_ROTATION:"Fixn rotcia:",RESTITUTION:"Prunos:",FRICTION:"Trenie:",DENSITY:"Hustota:",COLOR:"Farba:",LAYER:"Vrstva:",DELETE_BUTTON:"Odstrni objekt",DELETE_CONFIRM:"Naozaj chcete odstrni tento objekt?",SET_BEHAVIORS:"Nastavi sprvanie",BODY_TYPE:"Druh telesa:",BODY_TYPES:{DYNAMIC:"Dynamick",STATIC:"Statick",KINEMATIC:"Kinematick"},GRAVITY_X:"Sila gravitcie v osi X:",GRAVITY_Y:"Sila gravitcie v osi Y:",CAMERA_STYLE:"tl kamery:",CAMERA_STYLES:{FIXED:"Zameran na bod",ENTITY:"Zameran na objekt"},CAMERA_X:"Pozcia kamery na osi X",CAMERA_Y:"Pozcia kamery na osi Y",CAMERA_ENTITY:"ID objektu pre zameranie kamery:"}}},{}]},{},[14]);