!function t(e,i,n){function s(r,a){if(!i[r]){if(!e[r]){var p="function"==typeof require&&require;if(!a&&p)return p(r,!0);if(o)return o(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var h=i[r]={exports:{}};e[r][0].call(h.exports,function(t){var i=e[r][1][t];return s(i?i:t)},h,h.exports,t,e,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(t,e,i){var n=t("./token.js").Action,s=t("./typing.js").Type;e.exports=[];var o=function(t,e){n.call(this,"setColor",arguments,[s.ENTITYFILTER,s.STRING]),this.args.push(t),this.args.push(e)};o.prototype=new n,o.prototype.each=function(t){t.setColor(this.args[1].evaluate())},o.prototype.constructor=o,e.exports.push(o);var r=function(t,e){n.call(this,"applyTorque",arguments,[s.ENTITYFILTER,s.NUMBER]),this.args.push(t),this.args.push(e)};r.prototype=new n,r.prototype.each=function(t){t.body.SetAwake(1),t.body.ApplyTorque(t.getMass()*this.args[1].evaluate())},r.prototype.constructor=r,e.exports.push(r);var a=function(t,e){n.call(this,"applyAngularImpulse",arguments,[s.ENTITYFILTER,s.NUMBER]),this.args.push(t),this.args.push(e)};a.prototype=new n,a.prototype.each=function(t){t.body.SetAwake(1),t.body.ApplyAngularImpulse(t.getMass()*this.args[1].evaluate())},a.prototype.constructor=a,e.exports.push(a);var p=function(t,e,i){n.call(this,"setLinearVelocity",arguments,[s.ENTITYFILTER,s.NUMBER,s.NUMBER]),this.args.push(t),this.args.push(e),this.args.push(i)};p.prototype=new n,p.prototype.each=function(t){t.body.SetAwake(1),t.setLinearVelocity(new b2Vec2(this.args[1].evaluate(),this.args[2].evaluate()))},p.prototype.constructor=p,e.exports.push(p);var u=function(t,e,i){n.call(this,"applyLinearImpulse",arguments,[s.ENTITYFILTER,s.NUMBER,s.NUMBER]),this.args.push(t),this.args.push(e),this.args.push(i)};u.prototype=new n,u.prototype.each=function(t){t.body.SetAwake(1),t.applyLinearImpulse(new b2Vec2(t.getMass()*this.args[1].evaluate(),t.getMass()*this.args[2].evaluate()))},u.prototype.constructor=u,e.exports.push(u)},{"./token.js":17,"./typing.js":21}],2:[function(t,e,i){var n=function(t,e){this.logic=t,this.results=Array.isArray(e)?e:[e]};n.prototype.check=function(t){return this.logic.evaluate(t)},n.prototype.toString=function(){return"Behavior("+this.logic.toString()+", "+this.results.toString()+")"},n.prototype.result=function(){for(var t=0;t<this.results.length;t++)this.results[t].execute()},e.exports=n},{}],3:[function(t,e,i){var n=t("./typing.js").FixType,s=t("./typing.js").Type,o=function(t){this.tokenManager=t};o.prototype.initialize=function(t,e){var i=el("span.ui.button",{},["+"]);i.type=t,i.onclick=this.buildChoiceClick(),$(e).html(i)},o.prototype.buildChoiceClick=function(){var t=this;return function(e){e.stopPropagation(),t.buildChoice(t.tokenManager.getTokensByType(this.type),this)}},o.prototype.buildArgument=function(t,e,i){return void 0!=t.args[e]?t.argument_types[e]===s.LITERAL?($(i).replaceWith(document.createTextNode(t.args[e])),!0):(this.buildToken(t.args[e],i),!0):t.argument_types[e]===s.LITERAL?(t.populate(),!!t.validate()&&($(i).replaceWith(document.createTextNode(t.args[e])),!0)):(this.initialize(t.argument_types[e],i),!0)},o.prototype.buildToken=function(t,e){var i=el("span.token",{},[el("span.name",{},[t.name])]);i.type=t.type,i.onclick=this.buildChoiceClick();var s;if(i.onmouseover=function(t){t.stopPropagation(),$(this).addClass("hover")},i.onmouseout=function(t){$(this).removeClass("hover")},t.fixType===n.PREFIX){i.appendChild(document.createTextNode("( "));for(var o=this,r=0;r<t.argument_types.length;r++){if(s=el("span.argument"),i.appendChild(s),!o.buildArgument(t,r,s))return;r!==t.argument_types.length-1&&i.appendChild(document.createTextNode(", "))}i.appendChild(document.createTextNode(" )"))}t.fixType===n.INFIX&&(i.insertBefore(document.createTextNode(" ) "),i.firstChild),i.appendChild(document.createTextNode(" ( ")),s=el("span"),i.insertBefore(s,i.firstChild),i.insertBefore(document.createTextNode(" ( "),i.firstChild),this.buildArgument(t,0,s),s=el("span"),i.appendChild(s),i.appendChild(document.createTextNode(" ) ")),this.buildArgument(t,1,s)),$(e).replaceWith(i)},o.prototype.buildChoice=function(t,e){$("div#tokenChoice").remove();var i=el("div#tokenChoice"),s=this;t.forEach(function(t){var o=el("div.token",{},[el("span.name",{},[t.name])]);t.fixType===n.PREFIX&&o.appendChild(el("span.argument",{},["( ",t.argument_types.join(", ")," )"])),t.fixType===n.INFIX&&(o.insertBefore(el("span.argument",{},["( ",t.argument_types[0]," )"]),o.firstChild),o.appendChild(el("span.argument",{},["( ",t.argument_types[1]," )"]))),$(o).on("click",function(i){s.buildToken(new t.constructor,e)}),i.appendChild(o)}),document.body.appendChild(i),$(document).one("click",function(t){$("div#tokenChoice").remove()});var o=15;$(i).css("left",_engine.input.mouse.realX+o+"px"),$(i).css("top",_engine.input.mouse.realY+o+"px")},e.exports=o},{"./typing.js":21}],4:[function(t,e,i){var n={DYNAMIC_BODY:Module.b2_dynamicBody,STATIC_BODY:Module.b2_staticBody,KINEMATIC_BODY:Module.b2_kinematicBody};e.exports=n},{}],5:[function(t,e,i){var n=t("./constants.js"),s=function(t,e,i,s,o,r,a,p){return this.width=e,this.height=i,this.image=new Image,this.image.src=o,this.position=s,this.entity=t,this.collisionGroup=n.COLLISION_GROUPS_NUMBER-1,this.recalculatePosition(),void 0==r&&(r=function(){}),void 0==a&&(a=function(){}),void 0==p&&(p=function(){}),this.move=r.bind(this),this.click=function(){a.apply(this,arguments),$(document).one("mouseup",this.release),$(_engine.viewport.canvasElement).on("mousemove",this.move)},this.release=function(){p.apply(this,arguments),$(_engine.viewport.canvasElement).off("mousemove",this.move)},this};s.prototype.recalculatePosition=function(){var t=this.entity.getWidth(),e=this.entity.getHeight();this.x=t/2*this.position[0],this.y=e/2*this.position[1],this.fixture&&this.entity.body.DestroyFixture(this.fixture),this.shape=new b2PolygonShape,this.shape.SetAsBox(_engine.viewport.toScale(this.width/2),_engine.viewport.toScale(this.height/2),new b2Vec2(this.x,this.y),0),this.fixture=new b2FixtureDef,this.fixture.set_shape(this.shape);var i=this.fixture.get_filter();i.set_categoryBits(1<<this.collisionGroup),i.set_maskBits(_engine.collisionGroups[this.collisionGroup].mask),this.fixture.set_filter(i),this.fixture=this.entity.body.CreateFixture(this.fixture)},s.prototype.testPoint=function(t,e){return this.fixture.TestPoint(new b2Vec2(t,e))},s.prototype.draw=function(t){t.drawImage(this.image,-this.width/2,-this.height/2,this.width,this.height)},e.exports=s},{"./constants.js":6}],6:[function(t,e,i){e.exports={COLLISION_GROUPS_NUMBER:16,LAYERS_NUMBER:10,DEFAULT_SCALE:1/70,AUTO_ID_PREFIX:"Entity ",SHAPE_MIN_SIZE:.2,TIME_STEP:60,STATE_STACK_SIZE:30,POSITION_TOP_LEFT:[-1,-1],POSITION_TOP:[0,-1],POSITION_TOP_RIGHT:[1,-1],POSITION_RIGHT:[1,0],POSITION_BOTTOM_RIGHT:[1,1],POSITION_BOTTOM:[0,1],POSITION_BOTTOM_LEFT:[-1,1],POSITION_LEFT:[-1,0],sideOrder:[[0,-1],[1,0],[0,1],[-1,0]]}},{}],7:[function(t,e,i){var n=t("./ui.js"),s=t("./tools.js"),o=t("./tokenmanager.js"),r=t("./constants.js"),a=t("./updateevent.js"),p=t("./statemanager.js"),u=function(e,i){this.viewport=e,this.selectedEntity=null,this.selectedTool=s.Selection,this.helpers=[],this.bufferVec2=new b2Vec2(0,0),this.layers=new Array(r.LAYERS_NUMBER);for(var n=0;n<r.LAYERS_NUMBER;n++)this.layers[n]=[];this.collisionGroups=[];for(var n=0;n<r.COLLISION_GROUPS_NUMBER-1;n++)this.collisionGroups.push({name:n+1,mask:parseInt("0"+Array(r.COLLISION_GROUPS_NUMBER).join("1"),2)});this.collisionGroups.push({name:"Helpers",mask:parseInt(Array(r.COLLISION_GROUPS_NUMBER+1).join("0"),2)}),this.lifetimeEntities=0,this.world=new b2World(i,(!0)),this.world.paused=!0,this.tokenManager=new o;var a=t("./input.js");this.input=new a(e),this.stateManager=new p(this),$(e.canvasElement).on("mousedown",function(){this.selectedTool.onclick()}.bind(this)),$(e.canvasElement).on("mouseup",function(){this.selectedTool.onrelease()}.bind(this)),$(document).on("update",function(t){t.detail.noState||this.stateManager.addState()}.bind(this))};u.prototype.togglePause=function(){if(this.world.paused=!this.world.paused,this.selectEntity(null),this.selectTool(this.world.paused?s.Selection:s.Blank),$("#selectionTool")[0].checked=!0,!this.world.paused){var t=this.entities();t.forEach(function(t){t.body.SetAwake(1)})}},u.prototype.vec2=function(t,e){return this.bufferVec2.set_x(t),this.bufferVec2.set_y(e),this.bufferVec2},u.prototype.selectTool=function(t){this.selectedTool=t,this.selectEntity(null)},u.prototype.removeEntity=function(t){this.selectEntity(null),this.world.DestroyBody(t.body),this.layers[t.layer].splice(this.layers[t.layer].indexOf(t),1)},u.prototype.setEntityLayer=function(t,e){this.layers[t.layer].splice(this.layers[t.layer].indexOf(t),1),t.layer=e,this.layers[e].push(t),a.fire(a.LAYER_CHANGE,{entities:[t]})},u.prototype.entities=function(){return[].concat.apply([],this.layers)},u.prototype.getEntityById=function(t){for(var e=this.entities(),i=0;i<e.length;i++)if(e[i].id===t)return e[i];return null},u.prototype.getEntitiesByCollisionGroup=function(t){for(var e=[],i=this.entities(),n=0;n<i.length;n++)i[n].collisionGroup===t&&e.push(i[n]);return e},u.prototype.addEntity=function(t,e){return void 0===t.id&&(t.id=r.AUTO_ID_PREFIX+this.lifetimeEntities),this.lifetimeEntities++,t.body.set_type(e),t.body=this.world.CreateBody(t.body),t.fixture=t.body.CreateFixture(t.fixture),this.layers[t.layer].push(t),t.addHelpers(),t},u.prototype.getCollision=function(t,e){return this.collisionGroups[t].mask>>e&1},u.prototype.setCollision=function(t,e,i){var n=1<<e,s=1<<t;return i?(this.collisionGroups[t].mask=this.collisionGroups[t].mask|n,this.collisionGroups[e].mask=this.collisionGroups[e].mask|s):(this.collisionGroups[t].mask=this.collisionGroups[t].mask&~n,this.collisionGroups[e].mask=this.collisionGroups[e].mask&~s),this.updateCollisions(),this},u.prototype.selectEntity=function(t){this.selectedEntity=t,n.buildSidebar(this.selectedEntity),t&&t.recalculateHelpers()},u.prototype.updateCollisions=function(){for(var t=this.entities(),e=0;e<t.length;e++)this.updateCollision(t[e]);return this},u.prototype.updateCollision=function(t){var e=t.fixture.GetFilterData();return e.set_maskBits(this.collisionGroups[t.collisionGroup].mask),t.fixture.SetFilterData(e),a.fire(a.COL_GROUP_CHANGE,{entities:[t]}),this},u.prototype.step=function(){var t=Date.now();if(ctx=this.viewport.context,ctx.clearRect(0,0,this.viewport.width,this.viewport.height),ctx.save(),this.world.paused)this.selectedTool.onmove(ctx);else{this.world.Step(1/r.TIME_STEP,10,5);for(var e=this.entities(),i=0;i<e.length;i++)for(var n=0;n<e[i].behaviors.length;n++){var s=e[i].behaviors[n];s.check(e[i])&&s.result()}}for(var o=0;o<r.LAYERS_NUMBER;o++)for(var a=this.layers[o].length-1;a>=0;a--)this.drawEntity(this.layers[o][a],ctx);this.selectedEntity&&(this.drawBoundary(ctx),this.selectedEntity.showHelpers&&this.drawHelpers(this.selectedEntity,ctx)),this.input.cleanUp();var p=Date.now();setTimeout(window.requestAnimationFrame(function(){_engine.step()}),Math.min(r.TIME_STEP-p-t,0))},u.prototype.drawBoundary=function(t){var e=this.selectedEntity.getWidth()/2,i=this.selectedEntity.getHeight()/2,n=this.selectedEntity.getX(),s=this.selectedEntity.getY();t.save(),t.translate(this.viewport.fromScale(-this.viewport.x+n)+this.viewport.width/2,this.viewport.fromScale(-this.viewport.y+s)+this.viewport.height/2),t.rotate(this.selectedEntity.getAngle()),t.globalCompositeOperation="xor",t.strokeRect(this.viewport.fromScale(-e),this.viewport.fromScale(-i),this.viewport.fromScale(2*e),this.viewport.fromScale(2*i)),t.restore()},u.prototype.drawHelpers=function(t,e){e.save(),e.translate(this.viewport.fromScale(-this.viewport.x+t.getX())+this.viewport.width/2,this.viewport.fromScale(-this.viewport.y+t.getY())+this.viewport.height/2),e.rotate(t.getAngle());for(var i=0;i<t.helpers.length;i++){e.save();var n=t.helpers[i].x,s=t.helpers[i].y;e.translate(this.viewport.fromScale(n),this.viewport.fromScale(s)),t.helpers[i].draw(e),e.restore()}e.restore()},u.prototype.drawEntity=function(t,e){e.save(),e.translate(this.viewport.fromScale(-this.viewport.x+t.getX())+this.viewport.width/2,this.viewport.fromScale(-this.viewport.y+t.getY())+this.viewport.height/2),e.rotate(t.getAngle()),t===this.selectedEntity&&(e.globalAlpha=1),e.fillStyle=t.color,t.draw(e),e.restore()},e.exports=u},{"./constants.js":6,"./input.js":12,"./statemanager.js":16,"./tokenmanager.js":18,"./tools.js":19,"./ui.js":22,"./updateevent.js":24}],8:[function(t,e,i){var n=t("./utils.js"),s=t("./constants.js"),o=t("./geometry.js"),r=t("./updateevent.js"),a=[0,230],p=function(t,e,i,s,o){if(this.id=s,this.dead=!1,this.layer=0,this.helpers=[],this.showHelpers=!0,this.fixedRotation=!1,this.collisionGroup=o,void 0==this.collisionGroup&&(this.collisionGroup=0),this.behaviors=[],this.fixture=e,void 0==this.fixture){var r=new b2FixtureDef;r.set_density(10),r.set_friction(.5),r.set_restitution(.2),this.fixture=r}this.fixture.set_shape(t);var p=this.fixture.get_filter();p.set_categoryBits(1<<o),"undefined"!=typeof _engine&&p.set_maskBits(_engine.collisionGroups[this.collisionGroup].mask),this.fixture.set_filter(p),this.body=i,void 0!==this.body&&this.body.set_fixedRotation(!1);var u=n.randomRange(a[0],a[1]).toString(16);u=1==u.length?"0"+u:u;var h=n.randomRange(a[0],a[1]).toString(16);h=1==h.length?"0"+h:h;var l=n.randomRange(a[0],a[1]).toString(16);l=1==l.length?"0"+l:l,this.color="#"+u+h+l};p.prototype.getPosition=function(){return this.body.GetPosition()},p.prototype.setPosition=function(t,e,i){void 0==e&&(e=t.get_y(),t=t.get_x()),this.body.SetTransform(new b2Vec2(t,e),this.getAngle()),i||r.fire(r.REPOSITION,{entities:[this]})},p.prototype.getAngle=function(t){return t?o.clampDegrees(o.toDegrees(this.body.GetAngle())):o.clampRadians(this.body.GetAngle())},p.prototype.setAngle=function(t,e,i){var n=e?o.toRadians(t):t;this.body.SetTransform(this.getPosition(),o.clampRadians(n)),i||r.fire(r.ROTATE,{entities:[this]})},p.prototype.getX=function(){return this.body.GetPosition().get_x()},p.prototype.getY=function(){return this.body.GetPosition().get_y()},p.prototype.setX=function(t){this.setPosition(t,this.getY())},p.prototype.setY=function(t){this.setPosition(this.getX(),t)},p.prototype.getWidth=function(){throw"ERROR! Cannot get width: Use derived class."},p.prototype.getHeight=function(){throw"ERROR! Cannot get height: Use derived class."},p.prototype.getRestitution=function(){return this.fixture.GetRestitution()},p.prototype.setRestitution=function(t){this.fixture.SetRestitution(t),this.body.ResetMassData(),this.resize(this.getWidth()/2,this.getHeight()/2),_engine.world.Step(0,0,0),r.fire(r.RESTITUTION_CHANGE,{entities:[this]})},p.prototype.getFriction=function(){return this.fixture.GetFriction()},p.prototype.setFriction=function(t){this.fixture.SetFriction(t),this.body.ResetMassData(),this.resize(this.getWidth()/2,this.getHeight()/2),_engine.world.Step(0,0,0),r.fire(r.FRICTION_CHANGE,{entities:[this]})},p.prototype.getDensity=function(){return this.fixture.GetDensity()},p.prototype.setDensity=function(t){this.fixture.SetDensity(t),this.body.ResetMassData(),this.resize(this.getWidth()/2,this.getHeight()/2),_engine.world.Step(0,0,0),r.fire(r.DENSITY_CHANGE,{entities:[this]})},p.prototype.getColor=function(){return this.color},p.prototype.setColor=function(t){this.color=t,r.fire(r.COLOR_CHANGE,{entities:[this]})},p.prototype.getBodyType=function(){return this.body.GetType()},p.prototype.setBodyType=function(t){this.body.SetType(t),r.fire(r.BODY_TYPE_CHANGE,{entities:[this]})},p.prototype.addHelpers=function(){throw"ERROR! Cannot add helpers: Use derived class."},p.prototype.toggleHelpers=function(t){_engine.selectedEntity.showHelpers=t?t:!_engine.selectedEntity.showHelpers},p.prototype.recalculateHelpers=function(){for(var t=0;t<this.helpers.length;t++)this.helpers[t].recalculatePosition()},p.prototype.startRotate=function(){this.startRotation=this.entity.getAngle(),this.startPosition=new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y),this.entity.toggleHelpers(!1)},p.prototype.moveRotate=function(){this.entity.setAngle(this.startRotation+o.findAngleWithNegative(this.startPosition,new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y),this.entity.getPosition()),!1,!0)},p.prototype.getSide=function(t){var e=this.getX(),i=this.getY(),n=new b2Vec2(e,i),r=this.getWidth(),a=this.getHeight(),p=s.sideOrder.equalIndexOf(t)*(Math.PI/2),u=new b2Vec2(e-r/2,i-a/2),h=new b2Vec2(e+r/2,i-a/2),l=o.pointRotate(n,u,p),c=o.pointRotate(n,h,p);return[l,c]},p.prototype.die=function(){return this.dead=!0,this},p.prototype.draw=function(){throw"ERROR! Cannot draw Entity: Use derived classes."},p.prototype.setColor=function(t,e){return this.color=t,e||r.fire(r.COLOR_CHANGE,{entities:[this]}),this},p.prototype.setId=function(t){return this.id=t,r.fire(r.ID_CHANGE,{entities:[this]}),this},p.prototype.setCollisionGroup=function(t){return this.collisionGroup=t,_engine.updateCollision(this),this},p.prototype.getLinearVelocity=function(){return this.body.GetLinearVelocity()},p.prototype.getMass=function(){return Math.max(1,this.body.GetMass())},p.prototype.setLinearVelocity=function(t){return this.body.SetLinearVelocity(t),this},p.prototype.applyTorque=function(t){return this.body.ApplyTorque(t),this},p.prototype.applyLinearImpulse=function(t){return this.body.ApplyLinearImpulse(t,this.body.GetWorldCenter()),this},p.prototype.disableRotation=function(t,e){return this.fixedRotation=t,this.body.SetFixedRotation(t),e||r.fire(r.ROTATION_LOCKED,{entities:[this]}),this},p.prototype.addBehavior=function(t){return this.behaviors.push(t),this},e.exports=p},{"./constants.js":6,"./geometry.js":11,"./updateevent.js":24,"./utils.js":25}],9:[function(t,e,i){var n=t("./token.js").EntityFilter,s=t("./typing.js").Type;e.exports=[];var o=function(t){n.call(this,"filterById",arguments,[s.STRING]),this.args.push(t)};o.prototype=new n,o.prototype.decide=function(t){return t.id===this.args[0].evaluate()},o.prototype.constructor=o,e.exports.push(o);var r=function(t){n.call(this,"filterByGroup",arguments,[s.NUMBER]),this.args.push(t)};r.prototype=new n,r.prototype.decide=function(t){return t.collisionGroup+1===this.args[0].evaluate()},r.prototype.constructor=r,e.exports.push(r);var a=function(t){n.call(this,"filterByLayer",arguments,[s.NUMBER]),this.args.push(t)};a.prototype=new n,a.prototype.decide=function(t){return t.layer+1===this.args[0].evaluate()},a.prototype.constructor=a,e.exports.push(a)},{"./token.js":17,"./typing.js":21}],10:[function(t,e,i){t("./translations.js"),t("./input.js");var n=t("./engine.js"),s=t("./viewport.js"),o=t("./ui.js"),r=t("./bodytype.js"),a=t("./behavior.js"),p=t("./shapes.js").Circle,u=t("./shapes.js").Rectangle;o.initialize(),window._engine=new n(new s($("#mainCanvas")[0]),new b2Vec2(0,10)),_engine.addEntity(new p(new b2Vec2(0,0),.5),r.DYNAMIC_BODY).setCollisionGroup(2).setId("kruh").disableRotation(!1).addBehavior(new a(_engine.tokenManager.parser.parse('(( getVelocityX( filterById( text( "kruh" ) ) ) ) > (number( "-3" ))) AND (isButtonDown( number( 37 ) ) )'),_engine.tokenManager.parser.parse('applyLinearImpulse( filterById( text( "kruh" ) ), number( -0.3 ), number( 0 ) )'))).addBehavior(new a(_engine.tokenManager.parser.parse('((getVelocityY( filterById( text( "kruh" ) ) )) > (number( -5 ))) AND (isButtonDown( number( 38 ) ))'),_engine.tokenManager.parser.parse('applyLinearImpulse( filterById( text( "kruh" ) ), number( 0 ), number( -0.5 ) )'))).addBehavior(new a(_engine.tokenManager.parser.parse('((getVelocityX( filterById( text( "kruh" ) ) )) < (number( 3 ))) AND (isButtonDown( number( 39 ) ))'),_engine.tokenManager.parser.parse('applyLinearImpulse( filterById( text( "kruh" ) ), number( 0.3 ), number( 0 ) )'))),_engine.addEntity(new u(new b2Vec2(0,3),new b2Vec2(2,.25)),r.KINEMATIC_BODY).setId("platform").setCollisionGroup(1),window.requestAnimationFrame(function(){_engine.step()})},{"./behavior.js":2,"./bodytype.js":4,"./engine.js":7,"./input.js":12,"./shapes.js":15,"./translations.js":20,"./ui.js":22,"./viewport.js":26}],11:[function(t,e,i){e.exports={pointPointDistance:function(t,e){return Math.sqrt(this.pointPointDistance2(t,e))},pointPointDistance2:function(t,e){var i=t.get_x(),n=e.get_x(),s=t.get_y(),o=e.get_y();return this.square(i-n)+this.square(s-o)},square:function(t){return t*t},linePointDistance:function(t,e,i){var n=this.pointPointDistance2(t,e),s=t.get_x(),o=e.get_x(),r=i.get_x(),a=t.get_y(),p=e.get_y(),u=i.get_y();if(0===n)return this.pointPointDistance2(i,t);var h=((r-s)*(o-s)+(u-a)*(p-a))/n;return h=Math.max(0,Math.min(1,h)),this.pointPointDistance(i,new b2Vec2(s+h*(o-s),a+h*(p-a)))},pointRotate:function(t,e,i){i=-i;var n=Math.cos(i),s=Math.sin(i),o=t.get_x(),r=t.get_y(),a=e.get_x(),p=e.get_y();return new b2Vec2(n*(a-o)+s*(p-r)+o,n*(p-r)-s*(a-o)+r)},findAngle:function(t,e,i){var n=t.get_x(),s=e.get_x(),o=i.get_x(),r=t.get_y(),a=e.get_y(),p=i.get_y(),u=Math.sqrt(Math.pow(o-n,2)+Math.pow(p-r,2)),h=Math.sqrt(Math.pow(o-s,2)+Math.pow(p-a,2)),l=Math.sqrt(Math.pow(s-n,2)+Math.pow(a-r,2));return Math.acos((h*h+u*u-l*l)/(2*h*u))},findAngleWithNegative:function(t,e,i){var n=i.get_x(),s=i.get_y(),o=t.get_x(),r=t.get_y(),a=e.get_x(),p=e.get_y(),u=o-n,h=r-s,l=a-n,c=p-s;return Math.atan2(u,h)-Math.atan2(l,c)},toDegrees:function(t){return t*(180/Math.PI)},toRadians:function(t){return t*(Math.PI/180)},clampDegrees:function(t){return(t%360+360)%360},clampRadians:function(t){return(t%(2*Math.PI)+2*Math.PI)%(2*Math.PI)}}},{}],12:[function(t,e,i){var n=function(t){"use strict";this.viewport=t,this.mouse={x:0,y:0,canvasX:0,canvasY:0,realX:0,realY:0,leftDown:!1,rightDown:!1,leftUp:!1,rightUp:!1},this.keyboard={down:new Set,up:new Set,isDown:function(t){return this.down.has(t)},isUp:function(t){return this.up.has(t)}},document.addEventListener("mousemove",this.updateMousePosition.bind(this)),document.addEventListener("mousedown",this.updateMouseButtonsDown.bind(this)),document.addEventListener("mouseup",this.updateMouseButtonsUp.bind(this)),document.addEventListener("keydown",this.updateKeyboardButtonsDown.bind(this)),document.addEventListener("keyup",this.updateKeyboardButtonsUp.bind(this)),document.onselectstart=function(){return!1}};n.prototype.cleanUp=function(){this.mouse.leftUp=!1,this.mouse.rightUp=!1,this.keyboard.up.clear()},n.prototype.updateMousePosition=function(t){this.mouse.canvasX=t.pageX-this.viewport.canvasElement.getBoundingClientRect().left,this.mouse.canvasY=t.pageY-this.viewport.canvasElement.getBoundingClientRect().top,this.mouse.x=this.viewport.toScale(this.mouse.canvasX)+this.viewport.x-this.viewport.toScale(this.viewport.width)/2,this.mouse.y=this.viewport.toScale(this.mouse.canvasY)+this.viewport.y-this.viewport.toScale(this.viewport.height)/2,this.mouse.realX=t.pageX,this.mouse.realY=t.pageY},n.prototype.updateMouseButtonsDown=function(t){1===t.which&&(this.mouse.leftDown=!0),3===t.which&&(this.mouse.rightDown=!0)},n.prototype.updateMouseButtonsUp=function(t){1===t.which&&(this.mouse.leftDown=!1,this.mouse.leftUp=!0),3===t.which&&(this.mouse.rightDown=!1,this.mouse.rightUp=!0)},n.prototype.updateKeyboardButtonsDown=function(t){this.keyboard.down.add(t.which),32===t.which&&t.preventDefault()},n.prototype.updateKeyboardButtonsUp=function(t){this.keyboard.down.delete(t.which),this.keyboard.up.add(t.which)},e.exports=n},{}],13:[function(t,e,i){var n=t("./token.js").Logic,s=t("./translations.js"),o=t("./token.js").Literal,r=t("./typing.js").Type,a=t("./typing.js").FixType;e.exports=[];var p=function(t,e){n.call(this,"AND",r.BOOLEAN,arguments,[r.BOOLEAN,r.BOOLEAN]),this.fixType=a.INFIX,this.args.push(t),this.args.push(e)};p.prototype=new n,p.prototype.evaluate=function(){return this.args[0].evaluate()&&this.args[1].evaluate()},p.prototype.constructor=p,e.exports.push(p);var u=function(t,e){n.call(this,"OR",r.BOOLEAN,arguments,[r.BOOLEAN,r.BOOLEAN]),this.fixType=a.INFIX,this.args.push(t),this.args.push(e)};u.prototype=new n,u.prototype.evaluate=function(){return!(!this.args[0].evaluate()&&!this.args[1].evaluate())},u.prototype.constructor=u,e.exports.push(u);var h=function(t){n.call(this,"NOT",r.BOOLEAN,arguments,[r.BOOLEAN]),this.args.push(t)};h.prototype=new n,h.prototype.evaluate=function(){return!this.args[0].evaluate()},h.prototype.constructor=h,e.exports.push(h);var l=function(t){n.call(this,"text",r.STRING,arguments,[r.LITERAL]),this.args.push(t)};l.prototype=new n,l.prototype.evaluate=function(){return this.args[0].evaluate()},l.prototype.validate=function(){return!0},l.prototype.populate=function(){this.args[0]=new o(prompt(s.getTranslated("BEHAVIORS.INPUT_DIALOG")+this.name))},l.prototype.constructor=l,e.exports.push(l);var c=function(t){n.call(this,"number",r.NUMBER,arguments,[r.LITERAL]),this.args.push(t)};c.prototype=new n,c.prototype.evaluate=function(){return parseFloat(this.args[0].evaluate())},c.prototype.validate=function(){return $.isNumeric(this.args[0].evaluate())},c.prototype.populate=function(){this.args[0]=new o(prompt(s.getTranslated("BEHAVIORS.INPUT_DIALOG")+this.name))},c.prototype.constructor=c,e.exports.push(c);var d=function(){n.call(this,"true",r.BOOLEAN,arguments,[])};d.prototype=new n,d.prototype.evaluate=function(){return!0},d.prototype.constructor=d,e.exports.push(d);var g=function(t){n.call(this,"false",r.BOOLEAN,arguments,[])};g.prototype=new n,g.prototype.evaluate=function(){return!1},g.prototype.constructor=g,e.exports.push(g);var y=function(t){n.call(this,"isButtonDown",r.BOOLEAN,arguments,[r.NUMBER]),this.args.push(t)};y.prototype=new n,y.prototype.evaluate=function(){return _engine.input.keyboard.isDown(this.args[0].evaluate())},y.prototype.constructor=y,e.exports.push(y);var f=function(t){n.call(this,"isButtonUp",r.BOOLEAN,arguments,[r.NUMBER]),this.args.push(t)};f.prototype=new n,f.prototype.evaluate=function(){return _engine.input.keyboard.isUp(this.args[0].evaluate())},f.prototype.constructor=f,e.exports.push(f);var v=function(t,e){n.call(this,"randomNumber",r.NUMBER,arguments,[r.NUMBER,r.NUMBER]),this.args.push(t),this.args.push(e)};v.prototype=new n,v.prototype.evaluate=function(){return Utils.randomRange(this.args[0].evaluate()&&this.args[1].evaluate())},v.prototype.constructor=v,e.exports.push(v);var m=function(t){n.call(this,"getVelocityX",r.NUMBER,arguments,[r.ENTITYFILTER]),this.args.push(t)};m.prototype=new n,m.prototype.evaluate=function(){var t=this.args[0].filter()[0];return t.body.GetLinearVelocity().get_x()},m.prototype.constructor=m,e.exports.push(m);var E=function(t){n.call(this,"getVelocityY",r.NUMBER,arguments,[r.ENTITYFILTER]),this.args.push(t)};E.prototype=new n,E.prototype.evaluate=function(){var t=this.args[0].filter()[0];return t.body.GetLinearVelocity().get_y()},E.prototype.constructor=E,e.exports.push(E);var _=function(t,e){n.call(this,"+",r.NUMBER,arguments,[r.NUMBER,r.NUMBER]),this.args.push(t),this.args.push(e),this.fixType=a.INFIX};_.prototype=new n,_.prototype.evaluate=function(){return this.args[0].evaluate()+this.args[1].evaluate()},_.prototype.constructor=_,e.exports.push(_);var T=function(t,e){n.call(this,"*",r.NUMBER,arguments,[r.NUMBER,r.NUMBER]),this.args.push(t),this.args.push(e),this.fixType=a.INFIX};T.prototype=new n,T.prototype.evaluate=function(){return this.args[0].evaluate()*this.args[1].evaluate()},T.prototype.constructor=T,e.exports.push(T);var b=function(t,e){n.call(this,"/",r.NUMBER,arguments,[r.NUMBER,r.NUMBER]),this.args.push(t),this.args.push(e),this.fixType=a.INFIX};b.prototype=new n,b.prototype.evaluate=function(){return this.args[0].evaluate()/this.args[1].evaluate()},b.prototype.constructor=b,e.exports.push(b);var I=function(t,e){n.call(this,"-",r.NUMBER,arguments,[r.NUMBER,r.NUMBER]),this.args.push(t),this.args.push(e),this.fixType=a.INFIX};I.prototype=new n,I.prototype.evaluate=function(){return this.args[0].evaluate()+this.args[1].evaluate()},I.prototype.constructor=I,e.exports.push(I);var w=function(t,e){n.call(this,">",r.BOOLEAN,arguments,[r.NUMBER,r.NUMBER]),this.args.push(t),this.args.push(e),this.fixType=a.INFIX};w.prototype=new n,w.prototype.evaluate=function(){return this.args[0].evaluate()>this.args[1].evaluate()},w.prototype.constructor=w,e.exports.push(w);var R=function(t,e){n.call(this,"<",r.BOOLEAN,arguments,[r.NUMBER,r.NUMBER]),this.args.push(t),this.args.push(e),this.fixType=a.INFIX};R.prototype=new n,R.prototype.evaluate=function(){return this.args[0].evaluate()<this.args[1].evaluate()},R.prototype.constructor=R,e.exports.push(R)},{"./token.js":17,"./translations.js":20,"./typing.js":21}],14:[function(t,e,i){var n=(t("./typing").FixType,t("./typing").Type),s=t("./token.js").Literal,o=function(t){this.tokenManager=t,this.parserInput="",this.parserInputWhole="",this.parserStack=[]};o.prototype.fail=function(t){throw t+"\nRemaining input: "+this.parserInput},o.prototype.currentChar=function(){return this.parserInput.length?this.parserInput[0]:""},o.prototype.nextChar=function(){return this.parserInput[1]},o.prototype.removeChar=function(){this.parserInput=this.parserInput.slice(1)},o.prototype.readChar=function(){var t=this.currentChar();return this.removeChar(),t},o.prototype.readWhitespace=function(){for(;" "===this.currentChar();)this.removeChar()},o.prototype.readName=function(){this.readWhitespace();for(var t="";/[^ ,)("]/.test(this.currentChar());)t+=this.readChar();if('"'===this.currentChar()){for(this.readChar();'"'!==this.currentChar();)"\\"===this.currentChar()&&'"'===this.nextChar()?(this.readChar(),this.readChar(),t+='"'):t+=this.readChar();this.readChar()}return this.readWhitespace(),t},o.prototype.readParentheses=function(){if(this.readWhitespace(),"("===this.currentChar()){for(this.readChar();")"!==this.currentChar();)this.readWhitespace(),this.parseToken(),this.readWhitespace(),","===this.currentChar()&&(this.readChar(),this.readWhitespace());this.readChar()}},o.prototype.parseToken=function(){this.readParentheses();var t=this.readName(),e=this.tokenManager.getTokenByName(t);if(e=void 0===e?new s(t):new e.constructor,this.readParentheses(),e.type!==n.LITERAL)for(var i=e.argument_types.length-1;i>=0;i--){var o=this.parserStack.pop();e.argument_types[i]!==o.type&&this.fail("Expected "+e.argument_types[i]+", got "+o.type),e.args[i]=o}return this.parserStack.push(e),e},o.prototype.parse=function(t){return this.parserInput=t,this.parserInputWhole=t,this.parserStack=[],this.parseToken()},e.exports=o},{"./token.js":17,"./typing":21}],15:[function(t,e,i){function n(){p.fire(p.RESIZE,{entities:[_engine.selectedEntity],noState:!0}),p.fire(p.ROTATE,{entities:[_engine.selectedEntity],noState:!0}),p.fire(p.REPOSITION,{entities:[_engine.selectedEntity]}),_engine.selectedEntity.toggleHelpers(!1)}var s=t("./entity.js"),o=t("./constants.js"),r=t("./clickablehelper.js"),a=t("./geometry.js"),p=t("./updateevent.js"),u=function(t,e,i,n,o){var r=new b2CircleShape;r.set_m_radius(e);var a=new b2BodyDef;return a.set_position(t),s.call(this,r,i,a,n,o),this.radius=e,this.type="CIRCLE",this};u.prototype=new s,u.prototype.constructor=u,u.prototype.getWidth=function(){return 2*this.radius},u.prototype.getHeight=function(){return 2*this.radius},u.prototype.addHelpers=function(){this.helpers=[new r(this,15,15,o.POSITION_TOP_RIGHT,"img/resize-sw-ne.svg",this.moveResize,this.startResize,n),new r(this,15,15,o.POSITION_TOP_LEFT,"img/rotate.svg",this.moveRotate,this.startRotate,n)]},u.prototype.draw=function(t){t.beginPath(),t.arc(0,0,_engine.viewport.fromScale(this.radius),0,2*Math.PI,!1),t.fill(),t.strokeStyle="red",t.globalCompositeOperation="destination-out",t.beginPath(),t.moveTo(0,0),t.lineTo(0,_engine.viewport.fromScale(this.radius)),t.stroke(),t.closePath()},u.prototype.startResize=function(){this.startSize=this.entity.getWidth()/2,this.startDistance=a.pointPointDistance(new b2Vec2(this.entity.getX(),this.entity.getY()),new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y)),
this.entity.toggleHelpers(!1)},u.prototype.moveResize=function(){var t=a.pointPointDistance(new b2Vec2(this.entity.getX(),this.entity.getY()),new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y))/this.startDistance;this.entity.resize(this.startSize*t,!0)},u.prototype.resize=function(t,e){if(t<o.SHAPE_MIN_SIZE/2)return!1;var i=new b2FixtureDef;i.set_density(this.fixture.GetDensity()),i.set_friction(this.fixture.GetFriction()),i.set_restitution(this.fixture.GetRestitution()),i.set_filter(this.fixture.GetFilterData());var n=new b2CircleShape;return n.set_m_radius(t),this.radius=t,i.set_shape(n),this.body.DestroyFixture(this.fixture),this.fixture=this.body.CreateFixture(i),this.recalculateHelpers(),e||p.fire(p.RESIZE,{entities:[this]}),!0};var h=function(t,e,i,n,o){var r=new b2PolygonShape;r.SetAsBox(e.get_x(),e.get_y());var a=new b2BodyDef;return a.set_position(t),s.call(this,r,i,a,n,o),this.extents=e,this.type="RECTANGLE",this};h.prototype=new s,h.prototype.constructor=h,h.prototype.getWidth=function(){return 2*this.extents.get_x()},h.prototype.getHeight=function(){return 2*this.extents.get_y()},h.prototype.addHelpers=function(){this.helpers=[new r(this,15,15,o.POSITION_TOP_RIGHT,"img/resize-sw-ne.svg",this.moveResize,this.startResize,n),new r(this,15,15,o.POSITION_TOP_LEFT,"img/rotate.svg",this.moveRotate,this.startRotate,n),new r(this,7,7,o.POSITION_BOTTOM,"img/handle.svg",this.moveResizeSide,this.startResizeSide,n),new r(this,7,7,o.POSITION_TOP,"img/handle.svg",this.moveResizeSide,this.startResizeSide,n),new r(this,7,7,o.POSITION_LEFT,"img/handle.svg",this.moveResizeSide,this.startResizeSide,n),new r(this,7,7,o.POSITION_RIGHT,"img/handle.svg",this.moveResizeSide,this.startResizeSide,n)]},h.prototype.draw=function(t){var e=_engine.viewport.fromScale(this.extents.get_x()),i=_engine.viewport.fromScale(this.extents.get_y());t.fillRect(-e,-i,2*e,2*i)},h.prototype.startResizeSide=function(){this.startSize=[this.entity.getWidth()/2,this.entity.getHeight()/2],this.startPosition=new b2Vec2(this.entity.getX(),this.entity.getY()),this.entity.toggleHelpers(!1)},h.prototype.moveResizeSide=function(){var t=a.pointRotate(this.startPosition,new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y),-(this.entity.getAngle()+o.sideOrder.equalIndexOf(this.position)*(Math.PI/2))),e=this.startPosition.get_y()-t.get_y();this.entity.resize((this.startSize[0]+this.startSize[0]*Math.abs(this.position[1])+e*Math.abs(this.position[0]))/2,(this.startSize[1]+this.startSize[1]*Math.abs(this.position[0])+e*Math.abs(this.position[1]))/2,!0)&&this.entity.setPosition(a.pointRotate(this.startPosition,new b2Vec2(this.startPosition.get_x()+(e-this.startSize[0])/2*this.position[0],this.startPosition.get_y()+(e-this.startSize[1])/2*this.position[1]),this.entity.getAngle()),null,!0)},h.prototype.startResize=function(){this.startSize=[this.entity.getWidth()/2,this.entity.getHeight()/2],this.startDistance=a.pointPointDistance(this.entity.getPosition(),new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y)),this.entity.toggleHelpers(!1)},h.prototype.moveResize=function(){var t=a.pointPointDistance(this.entity.getPosition(),new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y))/this.startDistance;this.entity.resize(this.startSize[0]*t,this.startSize[1]*t,!0)},h.prototype.resize=function(t,e,i){if(2*t<o.SHAPE_MIN_SIZE||2*e<o.SHAPE_MIN_SIZE)return!1;var n=new b2FixtureDef;n.set_density(this.fixture.GetDensity()),n.set_friction(this.fixture.GetFriction()),n.set_restitution(this.fixture.GetRestitution()),n.set_filter(this.fixture.GetFilterData());var s=new b2PolygonShape;return s.SetAsBox(t,e),this.extents=new b2Vec2(t,e),n.set_shape(s),this.body.DestroyFixture(this.fixture),this.fixture=this.body.CreateFixture(n),this.recalculateHelpers(),i||p.fire(p.RESIZE,{entities:[this]}),!0},e.exports.Circle=u,e.exports.Rectangle=h},{"./clickablehelper.js":5,"./constants.js":6,"./entity.js":8,"./geometry.js":11,"./updateevent.js":24}],16:[function(t,e,i){var n=t("./constants.js"),s=t("./shapes.js"),o=t("./behavior.js"),r=t("./updateevent.js"),a=function(t){this.engine=t,this.stateStack=[],this.currentState=-1,this.addState()};a.prototype.addState=function(t){t=t?t:this.createState(),this.currentState+=1,this.stateStack.splice(this.currentState,this.stateStack.length-this.currentState,t),this.stateStack.length>n.STATE_STACK_SIZE&&(this.stateStack.shift(),this.currentState-=1),r.fire(r.STATE_CHANGE,{noState:!0,first:0===this.currentState,last:this.currentState===this.stateStack.length-1})},a.prototype.createState=function(){var t={};t.world={gravity:[this.engine.world.GetGravity().get_x(),this.engine.world.GetGravity().get_y()],collisionGroups:JSON.parse(JSON.stringify(this.engine.collisionGroups))},t.entities=[];for(var e=this.engine.entities(),i=0;i<e.length;i++){var n=e[i];t.entities.push({x:n.getX(),y:n.getY(),width:n.getWidth(),height:n.getHeight(),angle:n.getAngle(),fixedRotation:n.fixedRotation,type:n.type,color:n.getColor(),restitution:n.getRestitution(),friction:n.getFriction(),density:n.getDensity(),bodyType:n.getBodyType(),id:n.id,collisionGroup:n.collisionGroup,behaviors:_.map(n.behaviors,function(t){return[t.logic.toString(),_.map(t.results,function(t){return t.toString()})]})})}return t},a.prototype.buildState=function(t){this.clearWorld(),this.engine.world.SetGravity(new b2Vec2(t.world.gravity[0],t.world.gravity[1])),this.engine.collisionGroups=t.world.collisionGroups;for(var e=0;e<t.entities.length;e++){var i=t.entities[e],n=new b2FixtureDef;n.set_density(i.density),n.set_friction(i.friction),n.set_restitution(i.restitution);var a;switch(i.type){case"CIRCLE":a=new s.Circle(new b2Vec2(i.x,i.y),i.width/2,n,i.id,i.collisionGroup);break;case"RECTANGLE":a=new s.Rectangle(new b2Vec2(i.x,i.y),new b2Vec2(i.width/2,i.height/2),n,i.id,i.collisionGroup);break;default:throw"Error! Couldn't build a state: unknown entity type "+i.type}this.engine.addEntity(a,i.bodyType),a.setColor(i.color,!0),a.setAngle(i.angle,!1,!0),a.disableRotation(i.fixedRotation,!0);for(var p=0;p<i.behaviors.length;p++){var u=_.map(i.behaviors[p][1],function(t){return this.engine.tokenManager.parser.parse(t)}.bind(this));a.addBehavior(new o(this.engine.tokenManager.parser.parse(i.behaviors[p][0]),u))}}r.fire(r.STATE_CHANGE,{noState:!0,first:0===this.currentState,last:this.currentState===this.stateStack.length-1})},a.prototype.undo=function(){0!==this.currentState&&(this.currentState-=1,this.buildState(this.stateStack[this.currentState]))},a.prototype.redo=function(){this.currentState!==this.stateStack.length-1&&(this.currentState+=1,this.buildState(this.stateStack[this.currentState]))},a.prototype.clearWorld=function(){for(var t=this.engine.entities(),e=0;e<t.length;e++)this.engine.removeEntity(t[e])},e.exports=a},{"./behavior.js":2,"./constants.js":6,"./shapes.js":15,"./updateevent.js":24}],17:[function(t,e,i){var n=t("./typing.js").FixType,s=t("./typing.js").Type,o=function(t,e,i,s){this.type=e,this.fixType=n.PREFIX,this.name=t,this.args=void 0==i?[]:i,this.argument_types=s,this.args=[]};o.prototype.toString=function(){for(var t="",e=[],i=0;i<this.args.length;i++)e.push(this.args[i].toString());switch(e=e.join(", "),this.fixType){case n.PREFIX:t=this.name+"("+e+")";break;case n.INFIX:t="("+this.args[0].toString()+")"+this.name+"("+this.args[1].toString()+")"}return t};var r=function(t){this.type=s.LITERAL,this.value=t};r.prototype.toString=function(){return'"'+this.value+'"'},r.prototype.evaluate=function(){return this.value};var a=function(t,e,i,n){o.call(this,t,e,i,n)};a.prototype=new o,a.prototype.constructor=a,a.prototype.evaluate=function(){return!1};var p=function(t,e,i){o.call(this,t,s.ACTION,e,i)};p.prototype=new o,p.prototype.constructor=p,p.prototype.each=function(t){return!1},p.prototype.execute=function(){for(var t=this.args[0].filter(),e=0;e<t.length;e++)this.each(t[e])};var u=function(t,e,i){o.call(this,t,s.ENTITYFILTER,e,i)};u.prototype=new o,u.prototype.constructor=u,u.prototype.decide=function(t){return!1},u.prototype.filter=function(){for(var t=[],e=_engine.entities(),i=0;i<e.length;i++)this.decide(e[i])&&t.push(e[i]);return t},e.exports.Token=o,e.exports.Literal=r,e.exports.Action=p,e.exports.Logic=a,e.exports.EntityFilter=u},{"./typing.js":21}],18:[function(t,e,i){var n=t("./parser.js"),s=function(){this.tokens=[],this.registerTokens(t("./logic.js")),this.registerTokens(t("./actions.js")),this.registerTokens(t("./entityfilters.js")),this.parser=new n(this)};s.prototype.registerTokens=function(t){t.forEach(function(t){this.tokens.push(new t)},this)},s.prototype.getTokenByName=function(t){for(var e=0;e<this.tokens.length;e++)if(this.tokens[e].name===t)return this.tokens[e]},s.prototype.getTokensByType=function(t){var e=[];return this.tokens.forEach(function(i){i.type===t&&e.push(i)}),e},e.exports=s},{"./actions.js":1,"./entityfilters.js":9,"./logic.js":13,"./parser.js":14}],19:[function(t,e,i){var n=t("./shapes.js"),s=t("./bodytype.js"),o=t("./constants.js"),r=t("./updateevent.js"),a={onclick:function(){},onrelease:function(){},onmove:function(){}},p={origin:null,offset:null,mode:null,onclick:function(){if(_engine.selectedEntity)for(var t=_engine.selectedEntity.helpers.length-1;t>=0;t--)if(_engine.selectedEntity.helpers[t].testPoint(_engine.input.mouse.x,_engine.input.mouse.y))return void _engine.selectedEntity.helpers[t].click();_engine.selectEntity(null);for(var t=o.LAYERS_NUMBER-1;t>=0;t--)for(var e=0;e<_engine.layers[t].length;e++)if(_engine.layers[t][e].fixture.TestPoint(new b2Vec2(_engine.input.mouse.x,_engine.input.mouse.y)))return _engine.selectEntity(_engine.layers[t][e]),this.origin=[_engine.input.mouse.x,_engine.input.mouse.y],this.offset=[_engine.selectedEntity.body.GetPosition().get_x()-this.origin[0],_engine.selectedEntity.body.GetPosition().get_y()-this.origin[1]],this.mode="reposition-start",this.origin=[_engine.input.mouse.x,_engine.input.mouse.y],void _engine.selectedEntity.toggleHelpers(!1);this.mode="camera",this.origin=[_engine.viewport.x,_engine.viewport.y],this.offset=[_engine.input.mouse.canvasX,_engine.input.mouse.canvasY],_engine.viewport.canvasElement.style.cursor="url(img/grabbingcursor.png), move"},onrelease:function(){"reposition"===this.mode&&(_engine.selectedEntity.toggleHelpers(!0),r.fire(r.REPOSITION,{entities:[_engine.selectedEntity]})),"reposition-start"===this.mode&&_engine.selectedEntity.toggleHelpers(!0),this.origin=this.offset=this.mode=null,_engine.viewport.canvasElement.style.cursor="default"},onmove:function(){if(null!==this.mode&&("camera"===this.mode&&(_engine.viewport.x=this.origin[0]+_engine.viewport.toScale(this.offset[0]-_engine.input.mouse.canvasX),_engine.viewport.y=this.origin[1]+_engine.viewport.toScale(this.offset[1]-_engine.input.mouse.canvasY)),"reposition-start"!==this.mode||this.origin.equalTo([_engine.input.mouse.x,_engine.input.mouse.y])||(this.mode="reposition"),"reposition"===this.mode)){var t=Math.round(1e3*(_engine.input.mouse.x+this.offset[0]))/1e3,e=Math.round(1e3*(_engine.input.mouse.y+this.offset[1]))/1e3;_engine.selectedEntity.setPosition(t,e,!0)}}},u={origin:null,worldOrigin:null,w:0,h:0,onclick:function(){this.onmove=this.dragging,this.origin=[_engine.input.mouse.canvasX,_engine.input.mouse.canvasY],this.worldOrigin=[_engine.input.mouse.x,_engine.input.mouse.y]},onrelease:function(){this.w>=_engine.viewport.fromScale(o.SHAPE_MIN_SIZE)&&this.h>=_engine.viewport.fromScale(o.SHAPE_MIN_SIZE)&&(this.w*=_engine.viewport.scale,this.h*=_engine.viewport.scale,_engine.addEntity(new n.Rectangle(new b2Vec2(this.worldOrigin[0]+this.w/2,this.worldOrigin[1]+this.h/2),new b2Vec2(this.w/2,this.h/2)),s.DYNAMIC_BODY)),this.onmove=function(){},this.origin=null,this.worldOrigin=null,this.w=this.h=0},onmove:function(){},dragging:function(t){this.w=_engine.input.mouse.canvasX-this.origin[0],this.h=_engine.input.mouse.canvasY-this.origin[1],t.fillStyle="rgba(0, 0, 0, 0.4)",(this.w<_engine.viewport.fromScale(o.SHAPE_MIN_SIZE)||this.h<_engine.viewport.fromScale(o.SHAPE_MIN_SIZE))&&(t.fillStyle="rgba(255, 0, 0, 0.4)"),t.save(),t.fillRect(this.origin[0],this.origin[1],this.w,this.h),t.restore()}},h={origin:null,worldOrigin:null,radius:0,onclick:function(){this.onmove=this.dragging,this.origin=[_engine.input.mouse.canvasX,_engine.input.mouse.canvasY],this.worldOrigin=[_engine.input.mouse.x,_engine.input.mouse.y]},onrelease:function(){this.radius>=_engine.viewport.fromScale(o.SHAPE_MIN_SIZE)/2&&(this.radius*=_engine.viewport.scale,_engine.addEntity(new n.Circle(new b2Vec2(this.worldOrigin[0]+this.radius,this.worldOrigin[1]+this.radius),this.radius),s.DYNAMIC_BODY)),this.onmove=function(){},this.origin=null,this.worldOrigin=null,this.radius=0},onmove:function(){},dragging:function(t){this.radius=Math.min(_engine.input.mouse.canvasX-this.origin[0],_engine.input.mouse.canvasY-this.origin[1])/2,t.fillStyle="rgba(0, 0, 0, 0.4)",this.radius<_engine.viewport.fromScale(o.SHAPE_MIN_SIZE)/2&&(t.fillStyle="rgba(255, 0, 0, 0.4)"),t.save(),t.beginPath(),t.arc(this.origin[0]+this.radius,this.origin[1]+this.radius,this.radius,0,2*Math.PI,!1),t.fill(),t.restore()}};e.exports.Blank=a,e.exports.Selection=p,e.exports.Rectangle=u,e.exports.Circle=h},{"./bodytype.js":4,"./constants.js":6,"./shapes.js":15,"./updateevent.js":24}],20:[function(t,e,i){e.exports={strings:[t("../translations/english.js"),t("../translations/slovak.js")],currentLanguage:0,getTranslated:function(t,e){void 0==e&&(e=this.currentLanguage);for(var i=this.strings[e],n=t.split("."),s=0;s<n.length;++s){var o=n[s];if(!(o in i))throw"ERROR! No translation for "+t;i=i[o]}return i},getTranslatedWrapped:function(t,e){var i=el("span",{translation:t});return i.innerHTML=this.getTranslated(t,e),i},setLanguage:function(t){this.currentLanguage=t;for(var e=document.querySelectorAll("[translation]"),i=0;i<e.length;i++)e[i].innerHTML=this.getTranslated(e[i].getAttribute("translation"))},refresh:function(){this.setLanguage(this.currentLanguage)}}},{"../translations/english.js":27,"../translations/slovak.js":28}],21:[function(t,e,i){var n={BOOLEAN:"boolean",NUMBER:"number",STRING:"string",ARRAY:"array",ACTION:"action",ENTITYFILTER:"entityFilter",LITERAL:"literal"},s={INFIX:"infix",PREFIX:"prefix"};e.exports.Type=n,e.exports.FixType=s},{}],22:[function(t,e,i){var n=t("./tools.js"),s=t("./bodytype.js"),o=t("./uibuilder.js"),r=t("./constants.js"),a=t("./translations.js"),p=t("./updateevent.js"),u={initialize:function(){for(var t=[],e=0;e<a.strings.length;e++)t.push({text:a.getTranslated("LANGUAGE_NAME",e),value:e});var i=[{type:"button",id:"play",text:a.getTranslatedWrapped("START"),onclick:function(){_engine.togglePause(),_engine.world.paused?($("#play").html(a.getTranslatedWrapped("START")),$("#collisions, #tool").each(function(){this.enable()})):($("#play").html(a.getTranslatedWrapped("PAUSE")),$("#collisions, #tool").each(function(){this.disable()}))}},{type:"break"},{type:"button",id:"undo",disabled:!0,text:a.getTranslatedWrapped("UNDO"),onclick:function(){_engine.stateManager.undo()},onupdate:function(t,e){var i=$("#"+this.id)[0];i.enable(),t===p.STATE_CHANGE&&e.first&&i.disable()}},{type:"button",id:"redo",disabled:!0,text:a.getTranslatedWrapped("REDO"),onclick:function(){_engine.stateManager.redo()},onupdate:function(t,e){var i=$("#"+this.id)[0];i.enable(),t===p.STATE_CHANGE&&e.last&&i.disable()}},{type:"break"},{type:"button",id:"collisions",text:a.getTranslatedWrapped("COLLISION_GROUPS"),onclick:function(){o.popup(u.createCollisions())}},{type:"break"},{type:"html",content:a.getTranslatedWrapped("TOOL")},{type:"radio",id:"tool",elements:[{text:el.img({src:"./img/selection.svg"}),id:"selectionTool",checked:!0,onclick:function(){_engine.selectTool(n.Selection)}},{text:el.img({src:"./img/rectangle.svg"}),onclick:function(){_engine.selectTool(n.Rectangle)}},{text:el.img({src:"./img/circle.svg"}),onclick:function(){_engine.selectTool(n.Circle)}}]},{type:"break"},{type:"html",content:a.getTranslatedWrapped("ZOOM")},{type:"range",min:1,max:11,step:.1,value:6,width:"150px",disableWrite:!0,oninput:function(t){_engine.viewport.zoom(t)}},{type:"break"},{type:"select",options:t,onchange:function(t){a.setLanguage(1*t)}}];o.buildLayout(),$(".ui.toolbar")[0].appendChild(o.build(i)),$(".ui.content")[0].appendChild(el("canvas#mainCanvas"))},createCollisions:function(){for(var t=el("table.collisionTable"),e=0;e<r.COLLISION_GROUPS_NUMBER;e++){for(var i=el("tr"),n=0;n<r.COLLISION_GROUPS_NUMBER;n++){var s=el("td");if(0===e&&n>0)s.innerHTML="<div><span>"+_engine.collisionGroups[n-1].name+"</span></div>";else if(0===n&&0!==e)s.innerHTML=_engine.collisionGroups[e-1].name;else if(e<=n&&0!==n&&0!==e){s.row=e,s.col=n,s.onmouseover=function(t,e,i){return function(){for(var n=i.getElementsByTagName("td"),s=0;s<n.length;s++)n[s].className="",(n[s].row===t&&n[s].col<=e||n[s].col===e&&n[s].row<=t)&&(n[s].className="highlight")}}(e,n,t),s.onmouseout=function(t){return function(){for(var e=t.getElementsByTagName("td"),i=0;i<e.length;i++)e[i].className=""}}(t);var o=el("input",{type:"checkbox"});_engine.getCollision(e-1,n-1)&&o.setAttribute("checked","checked"),o.onchange=function(t,e,i){return function(){_engine.setCollision(t-1,e-1,i.checked?1:0)}}(e,n,o),s.onclick=function(t){return function(e){return e.target===t||(t.checked=!t.checked,void t.onchange())}}(o),s.appendChild(o)}else s.row=e,s.col=n;i.appendChild(s)}t.appendChild(i)}return t},createBehavior:function(e){for(var i=new(t("./behaviorbuilder.js"))(_engine.tokenManager),n=t("./uibuilder.js"),s=t("./typing.js").Type,o=function(t){var e=el("div.behavior"),o=el("div.tokenBuilder",{},[""]),p=el("div"),u=n.button({text:a.getTranslatedWrapped("BEHAVIORS.REMOVE_BEHAVIOR"),onclick:function(t){return function(){$(t).remove()}}(e)});if(u.style.float="right",null===t)i.initialize(s.BOOLEAN,o),p.appendChild(r(null,a.getTranslatedWrapped("BEHAVIORS.ACTION"),!1));else{i.buildToken(t.logic,o.firstChild),p.appendChild(r(t.results[0],a.getTranslatedWrapped("BEHAVIORS.ACTION"),!1));for(var h=1;h<t.results.length;h++)p.appendChild(r(t.results[h],a.getTranslatedWrapped("BEHAVIORS.ANOTHER_ACTION"),!0))}return p.appendChild(n.button({text:a.getTranslatedWrapped("BEHAVIORS.NEW_ACTION"),onclick:function(t){this.parentNode.insertBefore(r(null,a.getTranslatedWrapped("BEHAVIORS.ANOTHER_ACTION"),!0),this)}})),e.appendChild(el("h2",{},[a.getTranslatedWrapped("BEHAVIORS.CONDITION"),u])),e.appendChild(o),e.appendChild(p),e},r=function(t,e,o){var r=el("div"),p=el("div.tokenBuilder",{},[""]),u=n.button({text:a.getTranslatedWrapped("BEHAVIORS.REMOVE_BEHAVIOR"),onclick:function(t){return function(){$(t).prev().remove(),$(t).remove()}}(p)});return u.style.float="right",o||(u=""),r.appendChild(el("h2",{},[e,u])),r.appendChild(p),null===t?i.initialize(s.ACTION,p):i.buildToken(t,p.firstChild),r},u=el("div.behaviorWrapper"),h=0;h<e.behaviors.length;h++)u.appendChild(o(e.behaviors[h]));var l=this,c=el("div.bottom",{},[n.button({text:a.getTranslatedWrapped("BEHAVIORS.NEW_BEHAVIOR"),onclick:function(){u.appendChild(o(null)),u.scrollTop=u.scrollHeight}}),n.break(),n.button({text:a.getTranslatedWrapped("BEHAVIORS.CANCEL_BUTTON"),onclick:function(){n.closePopup()}}),n.button({text:a.getTranslatedWrapped("BEHAVIORS.DONE_BUTTON"),onclick:function(){l.saveBehavior(e),p.fire(p.BEHAVIOR_CHANGE,{entities:[this]}),n.closePopup()}})]),d=el("div",{},[u,c]);return d},saveBehavior:function(e){var i=t("./behavior.js");e.behaviors=[];for(var n=$(".behaviorWrapper .behavior"),s=0;s<n.length;s++){var o=$(".tokenBuilder",n[s]);try{for(var r=_engine.tokenManager.parser.parse(o[0].textContent),a=[],p=1;p<o.length;p++)try{a.push(_engine.tokenManager.parser.parse(o[p].textContent))}catch(t){}if(0===a.length)throw"All results blank";e.behaviors.push(new i(r,a))}catch(t){}}},buildSidebar:function(t){var e=$(".sidebar.ui .content");if(e.html(""),null===t)return void $(".sidebar.ui .content").html(this.buildEntityList());var i=[{type:"html",content:a.getTranslatedWrapped("SIDEBAR.ID")},{type:"inputText",value:t.id,oninput:function(e){t.setId(e)}},{type:"html",content:el("p")},{type:"html",content:a.getTranslatedWrapped("SIDEBAR.COLLISION_GROUP")},{type:"range",value:t.collisionGroup+1,min:1,max:r.COLLISION_GROUPS_NUMBER-1,oninput:function(e){t.setCollisionGroup(1*e-1)}},{type:"html",content:el("p")},{type:"html",content:a.getTranslatedWrapped("SIDEBAR.LAYER")},{type:"range",value:t.layer+1,min:1,max:r.LAYERS_NUMBER,oninput:function(e){_engine.setEntityLayer(t,1*e-1)}},{type:"html",content:el("p")},{type:"html",content:a.getTranslatedWrapped("SIDEBAR.X")},{type:"inputNumber",value:t.getX(),id:"entity_x",oninput:function(e){t.setX(1*e)},onupdate:function(e,i){e===p.REPOSITION&&$("#"+this.id).val(t.getX())}},{type:"html",content:el("p")},{type:"html",content:a.getTranslatedWrapped("SIDEBAR.Y")},{type:"inputNumber",value:t.getY(),id:"entity_y",oninput:function(e){t.setY(1*e)},onupdate:function(e,i){e===p.REPOSITION&&$("#"+this.id).val(t.getY())}},{type:"html",content:el("p")},{type:"html",content:a.getTranslatedWrapped("SIDEBAR.WIDTH")},{type:"inputNumber",value:t.getWidth(),step:.1,id:"entity_width",oninput:function(e){t.resize(e/2,t.getHeight()/2)},onupdate:function(e,i){e===p.RESIZE&&$("#"+this.id).val(t.getWidth())}},{type:"html",content:el("p")},{type:"html",content:a.getTranslatedWrapped("SIDEBAR.HEIGHT")},{type:"inputNumber",value:t.getHeight(),step:.1,id:"entity_height",oninput:function(e){return"CIRCLE"===t.type?void t.resize(e/2):void t.resize(t.getWidth()/2,e/2)},onupdate:function(e,i){e===p.RESIZE&&$("#"+this.id).val(t.getHeight())}},{type:"html",content:el("p")},{type:"html",content:a.getTranslatedWrapped("SIDEBAR.ROTATION")},{type:"range",min:0,max:360,step:1,value:t.getAngle(!0),id:"entity_rotation",oninput:function(e){t.setAngle(1*e,!0)},onupdate:function(e,i){e===p.ROTATE&&($("#"+this.id).val(t.getAngle(!0)),$("#"+this.id+"-input").val(t.getAngle(!0)))}},{type:"html",content:el("p")},{type:"html",content:a.getTranslatedWrapped("SIDEBAR.FIXED_ROTATION")},{type:"checkbox",checked:t.fixedRotation,onchange:function(e){t.disableRotation(e)}},{type:"html",content:el("p")},{type:"html",content:a.getTranslatedWrapped("SIDEBAR.RESTITUTION")},{type:"range",min:0,max:1,step:.1,value:t.getRestitution(),oninput:function(e){t.setRestitution(1*e)}},{type:"html",content:el("p")},{type:"html",content:a.getTranslatedWrapped("SIDEBAR.FRICTION")},{type:"range",min:0,max:1,step:.1,value:t.getFriction(),oninput:function(e){t.setFriction(1*e)}},{type:"html",content:el("p")},{type:"html",content:a.getTranslatedWrapped("SIDEBAR.DENSITY")},{type:"inputNumber",value:t.getDensity(),min:0,oninput:function(e){t.setDensity(1*e)}},{type:"html",content:el("p")},{type:"html",content:a.getTranslatedWrapped("SIDEBAR.COLOR")},{type:"inputColor",value:t.getColor(),oninput:function(e){t.setColor(e)}},{type:"html",content:el("p")},{type:"html",content:a.getTranslatedWrapped("SIDEBAR.BODY_TYPE")},{type:"select",selected:t.getBodyType(),onchange:function(e){t.setBodyType(1*e)},options:[{text:a.getTranslatedWrapped("SIDEBAR.BODY_TYPES.DYNAMIC"),value:s.DYNAMIC_BODY},{text:a.getTranslatedWrapped("SIDEBAR.BODY_TYPES.KINEMATIC"),value:s.KINEMATIC_BODY},{text:a.getTranslatedWrapped("SIDEBAR.BODY_TYPES.STATIC"),value:s.STATIC_BODY}]},{type:"html",content:el("p")},{type:"button",text:a.getTranslatedWrapped("SIDEBAR.DELETE_BUTTON"),onclick:function(){confirm(a.getTranslated("SIDEBAR.DELETE_CONFIRM"))&&_engine.removeEntity(t)}},{type:"html",content:el("p")},{type:"button",text:a.getTranslatedWrapped("SIDEBAR.SET_BEHAVIORS"),onclick:function(){o.popup(u.createBehavior(t))}},{type:"html",content:el("p")}];e[0].appendChild(o.build(i))},buildEntityList:function(){for(var t=el("div.entityList"),e=0;e<r.LAYERS_NUMBER;e++)if(0!==_engine.layers[e].length){for(var i=el("div.layer",{},[a.getTranslatedWrapped("LAYER")," "+(e+1)+":"]),n=0;n<_engine.layers[e].length;n++){var s=_engine.layers[e][n],o=el("div.entity",{},[el("span",{},[el("span.id",{},[s.id]),": ",a.getTranslatedWrapped(s.type)])]);o.onclick=function(t){return function(){_engine.selectEntity(t)}}(s),i.appendChild(o)}t.appendChild(i)}return t}};e.exports=u},{"./behavior.js":2,"./behaviorbuilder.js":3,"./bodytype.js":4,"./constants.js":6,"./tools.js":19,"./translations.js":20,"./typing.js":21,"./uibuilder.js":23,"./updateevent.js":24}],23:[function(t,e,i){var n=t("./translations.js"),s={radio:function(t){t=$.extend({},{id:"radioGroup-"+$(".radioGroup").length},t);var e=el("div.ui.radioGroup",{id:t.id});e.disable=function(){$("input[type=radio]",this).each(function(){this.disable()})},e.enable=function(){$("input[type=radio]",this).each(function(){this.enable()})};var i=$("input[type=radio]").length;return t.elements.forEach(function(n){n=$.extend({},{id:"radio-"+i++,checked:!1,onclick:function(){}},n);var s=el("input.ui",{type:"radio",id:n.id,name:t.id}),o=el("label.ui.button",{for:n.id},[n.text]);s.enable=function(){this.disabled=!1,$("+label",this).removeClass("disabled")},s.disable=function(){this.disabled=!0,$("+label",this).addClass("disabled")},o.onclick=function(){$(this).hasClass("disabled")||n.onclick()},s.checked=n.checked,e.appendChild(s),e.appendChild(o)}),e},button:function(t){t=$.extend({},{id:"button-"+$(".button").length,onclick:function(){},onupdate:function(){},disabled:!1},t);var e=el("span.ui.button",{id:t.id},[t.text]);return e.disable=function(){$(this).addClass("disabled")},e.enable=function(){$(this).removeClass("disabled")},e.onclick=function(e){$(this).hasClass("disabled")||t.onclick.call(this,e)},document.addEventListener("update",function(e){t.onupdate(e.detail.action,e.detail)}),t.disabled&&e.disable(),e},select:function(t){t=$.extend({},{id:"select-"+$("select").length,selected:"",onchange:function(){}},t);var e=el("select.ui",{id:t.id});return e.onchange=function(){t.onchange(this.value)},e.disable=function(){$(this).addClass("disabled"),this.disabled=!0},e.enable=function(){$(this).removeClass("disabled"),this.disabled=enable},t.options.forEach(function(i,n){e.appendChild(el("option",{value:i.value},[i.text])),i.value==t.selected&&(e.selectedIndex=n)}),e},break:function(){return el("span.ui.break")},inputText:function(t){t=$.extend({},{id:"inputText-"+$("input[type=text]").length,value:"",oninput:function(){}},t);var e=el("input.ui",{type:"text",id:t.id,value:t.value});return e.disable=function(){$(this).addClass("disabled"),this.disabled=!0},e.enable=function(){$(this).removeClass("disabled"),this.disabled=!1},e.oninput=function(){t.oninput(this.value)},e},inputNumber:function(t){t=$.extend({},{id:"inputNumber-"+$("input[type=number]").length,value:0,min:-(1/0),max:1/0,step:1,oninput:function(){},onupdate:function(){}},t);var e=el("input.ui",{type:"number",id:t.id,value:t.value,min:t.min,max:t.max,step:t.step});return e.disable=function(){$(this).addClass("disabled"),this.disabled=!0},e.enable=function(){$(this).removeClass("disabled"),this.disabled=!1},e.oninput=function(e){t.oninput(this.value)},document.addEventListener("update",function(e){t.onupdate(e.detail.action,e.detail)}),e},html:function(t){return t=$.extend({},{content:""},t),t.content},inputColor:function(t){t=$.extend({},{id:"inputColor-"+$("input[type=color]").length,value:"#000000",oninput:function(){}},t);var e=el("input.ui.button",{type:"color",id:t.id,value:t.value});return e.disable=function(){$(this).addClass("disabled"),this.disabled=!0},e.enable=function(){$(this).removeClass("disabled"),this.disabled=!1},e.oninput=function(){t.oninput(this.value)},e},range:function(t){t=$.extend({},{id:"range-"+$("input[type=range]").length,value:0,min:0,max:10,step:1,width:"100%",disableWrite:!1,oninput:function(){},onupdate:function(){}},t);var e=$.extend({},t);e.id+="-input";var i=el("input.ui",{type:"range",min:t.min,max:t.max,step:t.step,value:t.value,id:t.id}),n=this.inputNumber(e);n.oninput=function(){t.oninput(n.value),i.value=n.value},i.disable=function(){$(this).addClass("disabled"),this.disabled=!0,$(n).addClass("disabled"),n.disabled=!0},i.enable=function(){$(this).removeClass("disabled"),this.disabled=!1,$(n).removeClass("disabled"),n.disabled=!1},i.oninput=function(){t.oninput(this.value),n.value=this.value},document.addEventListener("update",function(e){t.onupdate(e.detail.action,e.detail)});var s=[i,n];return t.disableWrite&&(s=[i]),el("div.ui.range",{style:"width:"+t.width},s)},checkbox:function(t){t=$.extend({},{id:"checkbox-"+$("input[type=checkbox]").length,checked:!1,onchange:function(){}},t);var e=el("span"),i=el("input.ui",{type:"checkbox",id:t.id}),n=el("label.ui.button",{for:t.id});return e.appendChild(i),e.appendChild(n),i.disable=function(){$("+label",this).addClass("disabled"),this.disabled=!0},i.enable=function(){$("+label",this).removeClass("disabled"),this.disabled=!1},i.checked=t.checked,i.onchange=function(){t.onchange(this.checked)},e},build:function(t){var e=el.div();return t.forEach(function(t){var i;switch(t.type){case"radio":i=this.radio(t);break;case"button":i=this.button(t);break;case"select":i=this.select(t);break;case"inputText":i=this.inputText(t);break;case"inputNumber":i=this.inputNumber(t);break;case"inputColor":i=this.inputColor(t);break;case"checkbox":i=this.checkbox(t);break;case"range":i=this.range(t);break;case"html":i=this.html(t);break;case"break":i=this.break()}e.appendChild(i)},this),e},buildLayout:function(){var t=el("div.ui.content.panel"),e=el("div.ui.sidebar.panel",{},[el("div.content")]),i=el("div.ui.resizer"),n=el("div.ui.toolbar"),s=$("body").outerWidth(),o=250;t.style.width=s-250+"px",e.style.width=o+"px";var r=function(i){i.preventDefault();var n=$("body").outerWidth(),s=Math.max(30,Math.min(.6*n,n-i.clientX)),o=n-s;e.style.width=s+"px",t.style.width=o+"px",window.onresize()},a=function(t){e.resizing=!1,$(".resizer.ui").removeClass("resizing"),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",a)},p=function(){var i=$("body").outerWidth(),n=Math.max(.4*i,Math.min(i-30,i-$(".sidebar.ui").outerWidth())),s=i-n;e.style.width=s+"px",t.style.width=n+"px"};i.onmousedown=function(t){e.resizing=!0,$(this).addClass("resizing"),window.addEventListener("mousemove",r),window.addEventListener("mouseup",a)},window.addEventListener("resize",p),t.appendChild(n),e.appendChild(i),document.body.appendChild(t),document.body.appendChild(e)},popup:function(t){var e=el("div#popupOverlay",[el("div#popupContent",[t])]);e.onclick=function(t){s.closePopup(t)},document.body.insertBefore(e,document.body.firstChild),n.refresh()},closePopup:function(t){var e=document.getElementById("popupOverlay"),i=document.getElementById("popupContent");return"undefined"!=typeof t&&t.target!==e||(i.parentNode.removeChild(i),void e.parentNode.removeChild(e))}};e.exports=s},{"./translations.js":20}],24:[function(t,e,i){var n={fire:function(t,e){$.extend({},e),e.action=t;var i=new CustomEvent("update",{detail:e});return document.dispatchEvent(i),i},RESIZE:"resize",ROTATE:"rotate",ROTATION_LOCKED:"rotation_locked",REPOSITION:"reposition",ID_CHANGE:"id_change",COL_GROUP_CHANGE:"col_group_change",LAYER_CHANGE:"layer_change",FRICTION_CHANGE:"friction_change",RESTITUTION_CHANGE:"restitution_change",DENSITY_CHANGE:"density_change",COLOR_CHANGE:"color_change",BODY_TYPE_CHANGE:"body_type_change",BEHAVIOR_CHANGE:"behavior_change",ENTITY_DELETE:"entity_delete",STATE_CHANGE:"state_change"};e.exports=n},{}],25:[function(t,e,i){var n={getBrowserWidth:function(){return $(".ui.content").outerWidth()},getBrowserHeight:function(){return $(".ui.content").outerHeight()-$(".ui.toolbar").outerHeight()},randomRange:function(t,e){return Math.floor(Math.random()*(e-t)+t)}};Array.prototype.equalTo=function(t){if(this.length!=t.length)return!1;for(var e=0;e<t.length;e++)if(this[e].equalTo){if(!this[e].equalTo(t[e]))return!1}else if(this[e]!==t[e])return!1;return!0},Array.prototype.equalIndexOf=function(t){for(var e=0;e<this.length;e++){if(this[e]===t)return e;if(Array.isArray(t)&&Array.isArray(this[e])&&this[e].equalTo(t))return e}return-1},e.exports=n},{}],26:[function(t,e,i){var n=t("./utils.js"),s=t("./constants.js"),o=function(t,e,i,n,o){
this.scale=s.DEFAULT_SCALE,void 0!=e&&void 0!=i?(this.setAutoResize(!1),this.width=e,this.height=i):(this.setAutoResize(!0),this.autoResize()),void 0!==n&&void 0!==o?(this.x=n,this.y=o):(this.x=0,this.y=0),this.canvasElement=t,void 0===t&&(this.canvasElement=document.createElement("canvas"),document.body.appendChild(this.canvasElement)),this.resetElement(),this.context=this.canvasElement.getContext("2d")};o.prototype.resetElement=function(){this.canvasElement.width=this.width,this.canvasElement.height=this.height},o.prototype.autoResize=function(){this.width=n.getBrowserWidth(),this.height=n.getBrowserHeight()},o.prototype.setAutoResize=function(t){if(this.autoResizeActive=t,this.autoResizeActive){var e=this;window.onresize=function(){e.autoResize(),e.resetElement()}}else window.onresize=null},o.prototype.zoom=function(t){var e=1.5;this.scale=s.DEFAULT_SCALE/Math.pow(e,6)*Math.pow(e,12-t),_engine.selectedEntity&&_engine.selectedEntity.recalculateHelpers()},o.prototype.getOffset=function(){return[this.x-this.width/2,this.y-this.height/2]},o.prototype.toScale=function(t){return t*this.scale},o.prototype.fromScale=function(t){return t/this.scale},e.exports=o},{"./constants.js":6,"./utils.js":25}],27:[function(t,e,i){e.exports={LANGUAGE_NAME:"English",COLLISION_GROUPS:"Collision groups",START:"Start",PAUSE:"Pause",UNDO:"Undo",REDO:"Redo",LAYER:"Layer ",ZOOM:"Zoom: ",TOOL:"Tool: ",RECTANGLE:"Rectangle",CIRCLE:"Circle",BEHAVIORS:{CONDITION:"When the following conditon is met:",INPUT_DIALOG:"Insert a correct value for ",ACTION:"Do this:",ANOTHER_ACTION:"And this:",NEW_ACTION:"Add new action",NEW_BEHAVIOR:"Add new behavior",REMOVE_ACTION:"Remove action",REMOVE_BEHAVIOR:"Remove behavior",DONE_BUTTON:"Done",CANCEL_BUTTON:"Cancel"},SIDEBAR:{ID:"ID:",COLLISION_GROUP:"Collision group:",X:"X-axis position:",Y:"Y-axis position:",WIDTH:"Width:",HEIGHT:"Height:",ROTATION:"Rotation:",FIXED_ROTATION:"Fixed rotation:",RESTITUTION:"Restitution:",FRICTION:"Friction:",DENSITY:"Density:",COLOR:"Color:",LAYER:"Layer:",DELETE_BUTTON:"Delete object",DELETE_CONFIRM:"Are you sure you want to delete this object?",SET_BEHAVIORS:"Set behavior",BODY_TYPE:"Body type:",BODY_TYPES:{DYNAMIC:"Dynamic",STATIC:"Static",KINEMATIC:"Kinematic"}}}},{}],28:[function(t,e,i){e.exports={LANGUAGE_NAME:"Slovensky",COLLISION_GROUPS:"Skupiny pre kolízie",START:"Štart",PAUSE:"Pauza",UNDO:"Krok späť",REDO:"Krok vpred",LAYER:"Vrstva ",ZOOM:"Priblíženie: ",TOOL:"Nástroj: ",RECTANGLE:"Obdĺžnik",CIRCLE:"Kruh",BEHAVIORS:{CONDITION:"Keď platí nasledujúca podmienka:",INPUT_DIALOG:"Zadajte korektnú hodnotu pre ",ACTION:"Sprav toto:",ANOTHER_ACTION:"A toto:",NEW_ACTION:"Pridať novú akciu",NEW_BEHAVIOR:"Pridať novú podmienku",REMOVE_ACTION:"Odstrániť akciu",REMOVE_BEHAVIOR:"Odstrániť podmienku",DONE_BUTTON:"Hotovo",CANCEL_BUTTON:"Zrušiť"},SIDEBAR:{ID:"ID:",COLLISION_GROUP:"Skupina pre kolízie:",X:"Pozícia na osi X:",Y:"Pozícia na osi Y:",WIDTH:"Šírka:",HEIGHT:"Výška:",ROTATION:"Rotácia:",FIXED_ROTATION:"Fixná rotácia:",RESTITUTION:"Pružnosť:",FRICTION:"Trenie:",DENSITY:"Hustota:",COLOR:"Farba:",LAYER:"Vrstva:",DELETE_BUTTON:"Odstrániť objekt",DELETE_CONFIRM:"Naozaj chcete odstrániť tento objekt?",SET_BEHAVIORS:"Nastaviť správanie",BODY_TYPE:"Druh telesa:",BODY_TYPES:{DYNAMIC:"Dynamické",STATIC:"Statické",KINEMATIC:"Kinematické"}}}},{}]},{},[10]);